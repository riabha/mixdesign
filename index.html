<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Concrete Mix Design Dashboard - QUEST</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        .container {
            max-width: 1700px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
            animation: fadeInDown 0.8s ease-out;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        header h1 {
            font-size: 3rem;
            margin-bottom: 12px;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.3);
            font-weight: 800;
            letter-spacing: -1px;
        }

        header p {
            font-size: 1.2rem;
            opacity: 0.98;
            margin-bottom: 10px;
            font-weight: 500;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .institution-info {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin: 0 auto 25px;
            max-width: 900px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .institution-info h3 {
            font-size: 1.4rem;
            margin-bottom: 12px;
            color: #fff;
            font-weight: 600;
        }

        .developers {
            display: flex;
            justify-content: center;
            gap: 25px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .developer {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s;
        }

        .developer:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .developer-icon {
            font-size: 1.2rem;
        }

        .institution-details {
            font-size: 1rem;
            opacity: 0.95;
            margin-top: 10px;
        }

        .preset-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 25px;
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }

        .preset-btn {
            padding: 14px 28px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            color: #6366f1;
            border: 2px solid rgba(255, 255, 255, 0.8);
            border-radius: 30px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1rem;
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.25);
            letter-spacing: 0.3px;
        }

        .preset-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            border-color: transparent;
        }

        .preset-btn:active {
            transform: translateY(-1px) scale(1.02);
        }
        
        .preset-btn:nth-child(1):hover {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .preset-btn:nth-child(2):hover {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        
        .preset-btn:nth-child(3):hover {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .preset-btn:nth-child(4):hover {
            background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
        }
        
        .preset-btn:nth-child(5):hover {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #2c3e50;
        }
        
        .preset-btn:nth-child(6):hover {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .preset-btn:nth-child(7):hover {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #2c3e50;
        }
        
        .preset-btn:nth-child(8):hover {
            background: linear-gradient(135deg, #f857a6 0%, #ff5858 100%);
        }
        
        .preset-btn:nth-child(9):hover {
            background: linear-gradient(135deg, #00d2ff 0%, #3a47d5 100%);
        }
        
        .preset-btn:nth-child(10):hover {
            background: linear-gradient(135deg, #06d6a0 0%, #1b9aaa 100%);
        }
        
        .preset-btn:nth-child(11):hover {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            color: #2c3e50;
        }
        
        .preset-btn:nth-child(12):hover {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
        }

        .preset-btn:active {
            transform: translateY(-1px) scale(1.02);
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1800px) {
            .dashboard {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (max-width: 1400px) {
            .dashboard {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 18px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08), 0 4px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            animation: fadeInUp 0.6s ease-out both;
            border: 2px solid rgba(255, 255, 255, 0.6);
        }

        .card:hover {
            transform: translateY(-6px);
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.18), 0 12px 24px rgba(0, 0, 0, 0.12);
            border-color: rgba(255, 255, 255, 0.9);
        }

        .card h2 {
            color: #6366f1;
            margin-bottom: 14px;
            font-size: 1.1rem;
            border-bottom: 3px solid;
            border-image: linear-gradient(90deg, #6366f1, #8b5cf6, #d946ef) 1;
            padding-bottom: 8px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 8px;
            letter-spacing: -0.3px;
        }

        .card.scm-card h2 {
            background: linear-gradient(90deg, #ff6b6b, #ee5a6f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            border-image: linear-gradient(90deg, #ff6b6b, #ee5a6f) 1;
        }

        .card.aggregate-card h2 {
            background: linear-gradient(90deg, #06d6a0, #1b9aaa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            border-image: linear-gradient(90deg, #06d6a0, #1b9aaa) 1;
        }

        .card.preset-card h2 {
            background: linear-gradient(90deg, #f72585, #b5179e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            border-image: linear-gradient(90deg, #f72585, #b5179e) 1;
        }

        .form-group {
            margin-bottom: 18px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .label-info {
            font-weight: normal;
            font-size: 0.85rem;
            color: #7f8c8d;
            font-style: italic;
        }

        .label-benefit {
            display: block;
            font-weight: normal;
            font-size: 0.8rem;
            color: #27ae60;
            margin-top: 5px;
        }

        input, select {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.85rem;
            transition: all 0.3s;
            background: #fafbfc;
            font-weight: 500;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #6366f1;
            background: white;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.12);
            transform: translateY(-1px);
        }

        input:disabled {
            background-color: #ecf0f1;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-weight: 500;
        }

        .radio-group input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .checkbox-group label {
            margin-bottom: 0;
            cursor: pointer;
        }

        .slider-container {
            margin-top: 10px;
        }

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100% !important;
            height: 10px;
            border-radius: 8px;
            background: linear-gradient(to right, #667eea, #764ba2);
            outline: none;
            cursor: pointer;
            margin: 10px 0;
            padding: 0 !important;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            cursor: grab;
            box-shadow: 0 3px 12px rgba(0,0,0,0.4);
            border: 4px solid #667eea;
            transition: all 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 16px rgba(0,0,0,0.5);
        }

        input[type="range"]::-webkit-slider-thumb:active {
            cursor: grabbing;
            transform: scale(1.1);
        }

        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            cursor: grab;
            box-shadow: 0 3px 12px rgba(0,0,0,0.4);
            border: 4px solid #667eea;
            transition: all 0.2s;
        }

        input[type="range"]::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 16px rgba(0,0,0,0.5);
        }

        input[type="range"]::-moz-range-thumb:active {
            cursor: grabbing;
            transform: scale(1.1);
        }

        /* Range track for Firefox */
        input[type="range"]::-moz-range-track {
            height: 10px;
            border-radius: 8px;
            background: linear-gradient(to right, #667eea, #764ba2);
        }

        .slider-value {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-left: 12px;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .scm-value {
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }

        .agg-value {
            background: linear-gradient(135deg, #06d6a0, #1b9aaa);
            box-shadow: 0 2px 8px rgba(6, 214, 160, 0.3);
        }

        .btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 1.15rem;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-top: 20px;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.35);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 36px rgba(139, 92, 246, 0.45);
        }

        .btn:active {
            transform: translateY(-2px);
        }

        .results-card {
            grid-column: 1 / -1;
        }

        .concrete-type-badge {
            display: inline-block;
            padding: 18px 42px;
            border-radius: 35px;
            font-size: 1.5rem;
            font-weight: 900;
            margin: 25px 0;
            text-align: center;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%);
            color: white;
            box-shadow: 0 12px 32px rgba(99, 102, 241, 0.4);
            animation: pulse 2s ease-in-out infinite;
            letter-spacing: 1.5px;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }

        .concrete-type-badge.hpc {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            box-shadow: 0 8px 25px rgba(250, 112, 154, 0.5);
        }

        .concrete-type-badge.uhpc {
            background: linear-gradient(135deg, #f72585 0%, #b5179e 100%);
            box-shadow: 0 8px 25px rgba(247, 37, 133, 0.5);
        }

        .concrete-type-badge.scc {
            background: linear-gradient(135deg, #06d6a0 0%, #1b9aaa 100%);
            box-shadow: 0 8px 25px rgba(6, 214, 160, 0.5);
        }

        .concrete-type-badge.mass {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.5);
        }

        .concrete-type-badge.normal {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .concrete-type-badge.foam {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #2c3e50;
            box-shadow: 0 8px 25px rgba(255, 236, 210, 0.5);
        }

        .concrete-type-badge.fiber {
            background: linear-gradient(135deg, #f857a6 0%, #ff5858 100%);
            box-shadow: 0 8px 25px rgba(248, 87, 166, 0.5);
        }

        .concrete-type-badge.geopolymer {
            background: linear-gradient(135deg, #00d2ff 0%, #3a47d5 100%);
            box-shadow: 0 8px 25px rgba(0, 210, 255, 0.5);
        }

        .concrete-type-badge.pervious {
            background: linear-gradient(135deg, #06d6a0 0%, #1b9aaa 100%);
            box-shadow: 0 8px 25px rgba(6, 214, 160, 0.5);
        }

        .concrete-type-badge.green {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            box-shadow: 0 8px 25px rgba(86, 171, 47, 0.5);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 18px;
            margin-top: 25px;
        }

        .result-item {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 28px;
            border-radius: 18px;
            text-align: center;
            transition: all 0.3s;
            border: 2px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .result-item:hover {
            transform: translateY(-4px) scale(1.02);
            border-color: #6366f1;
            box-shadow: 0 12px 28px rgba(99, 102, 241, 0.25);
        }

        .result-item.highlight {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            color: white;
        }
        
        .result-item.highlight .result-label,
        .result-item.highlight .result-unit {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .result-item.highlight .result-value {
            color: white;
        }

        .result-item.scm-highlight {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
        }
        
        .result-item.scm-highlight .result-label,
        .result-item.scm-highlight .result-unit {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .result-item.scm-highlight .result-value {
            color: white;
        }

        .result-label {
            font-size: 0.95rem;
            color: #666;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .result-value {
            font-size: 2.2rem;
            font-weight: 900;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .result-unit {
            font-size: 0.9rem;
            color: #888;
            margin-top: 5px;
        }

        .info-box {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border-left: 6px solid #f59e0b;
            padding: 24px;
            margin-top: 28px;
            border-radius: 16px;
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.18);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .info-box h3 {
            color: #92400e;
            margin-bottom: 14px;
            font-size: 1.25rem;
            font-weight: 800;
        }

        .info-box p {
            color: #92400e;
            font-size: 0.98rem;
            line-height: 1.7;
        }

        .admixture-box {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-left: 6px solid #3b82f6;
            padding: 24px;
            margin-top: 28px;
            border-radius: 16px;
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.18);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .admixture-box h3 {
            color: #1e40af;
            margin-bottom: 16px;
            font-size: 1.25rem;
            font-weight: 800;
        }

        .admixture-box p {
            color: #1e40af;
            font-size: 0.98rem;
            line-height: 1.7;
            margin-bottom: 12px;
        }

        .scm-box {
            background: linear-gradient(135deg, #ffe5e5 0%, #ffc4c4 100%);
            border-left: 5px solid #ff6b6b;
            padding: 20px;
            margin-top: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.2);
        }

        .scm-box h3 {
            color: #c92a2a;
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .scm-box p {
            color: #c92a2a;
            font-size: 0.95rem;
            line-height: 1.7;
            margin-bottom: 10px;
        }

        .concrete-type-box {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            border-left: 5px solid #9c27b0;
            padding: 20px;
            margin-top: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(156, 39, 176, 0.2);
        }

        .concrete-type-box h3 {
            color: #6a1b9a;
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .concrete-type-box p {
            color: #6a1b9a;
            font-size: 0.95rem;
            line-height: 1.7;
            margin-bottom: 10px;
        }

        .mix-proportions {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-left: 6px solid #22c55e;
            padding: 28px;
            margin-top: 28px;
            border-radius: 16px;
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.18);
            border: 1px solid rgba(34, 197, 94, 0.2);
        }

        .mix-proportions h3 {
            color: #166534;
            margin-bottom: 20px;
            font-size: 1.25rem;
            font-weight: 800;
        }

        .proportion-text {
            font-size: 1.6rem;
            font-weight: 900;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
        }

        .benefit-badge {
            display: inline-block;
            background: linear-gradient(135deg, #06d6a0, #1b9aaa);
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-top: 8px;
            box-shadow: 0 2px 8px rgba(6, 214, 160, 0.3);
            font-weight: 600;
        }

        .warning-box {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            border-left: 5px solid #f44336;
            padding: 15px;
            margin-top: 12px;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #c62828;
            box-shadow: 0 2px 10px rgba(244, 67, 54, 0.2);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 56px;
            height: 28px;
            margin-left: 12px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 28px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        input:checked + .toggle-slider {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(28px);
        }

        footer {
            text-align: center;
            color: white;
            padding: 40px 30px;
            margin-top: 50px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 28px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        footer h4 {
            font-size: 1.5rem;
            margin-bottom: 18px;
            font-weight: 800;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        footer p {
            margin: 10px 0;
            font-size: 1.05rem;
            opacity: 0.98;
            font-weight: 500;
        }

        footer .copyright {
            margin-top: 25px;
            font-size: 0.95rem;
            opacity: 0.9;
            border-top: 2px solid rgba(255, 255, 255, 0.3);
            padding-top: 20px;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            }
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2.2rem;
            }

            header p {
                font-size: 1.05rem;
            }

            .dashboard {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .preset-buttons {
                gap: 10px;
            }

            .preset-btn {
                padding: 12px 20px;
                font-size: 0.9rem;
            }

            .card {
                padding: 24px;
                border-radius: 20px;
            }

            .card h2 {
                font-size: 1.4rem;
            }

            .concrete-type-badge {
                font-size: 1.2rem;
                padding: 14px 28px;
            }

            .results-grid {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
                gap: 15px;
            }

            .result-value {
                font-size: 1.8rem;
            }

            .proportion-text {
                font-size: 1.3rem;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 12px;
            }

            header h1 {
                font-size: 1.8rem;
            }

            header p {
                font-size: 0.95rem;
            }

            .action-buttons {
                gap: 8px;
            }

            .action-btn {
                padding: 10px 20px !important;
                font-size: 0.85rem !important;
            }

            .card {
                padding: 20px;
                border-radius: 18px;
            }

            input, select {
                padding: 12px 14px;
                font-size: 0.95rem;
            }

            .btn {
                padding: 14px;
                font-size: 1rem;
            }

            .results-grid {
                grid-template-columns: 1fr;
                gap: 14px;
            }
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Card entrance animations with delays */
        .card:nth-child(1) { animation-delay: 0.1s; }
        .card:nth-child(2) { animation-delay: 0.2s; }
        .card:nth-child(3) { animation-delay: 0.3s; }
        .card:nth-child(4) { animation-delay: 0.4s; }
        .card:nth-child(5) { animation-delay: 0.5s; }
        .card:nth-child(6) { animation-delay: 0.6s; }

        /* Action buttons hover effects */
        .action-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
        }

        .action-btn:active {
            transform: translateY(-1px);
        }

        /* Print Report Styles */
        .print-report {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 10000;
            overflow-y: auto;
            padding: 40px;
        }
        
        .print-report.active {
            display: block;
        }
        
        .print-report-content {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .report-header {
            text-align: center;
            border-bottom: 3px solid #6366f1;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        .logo-circle {
            background: white;
            border-radius: 50%;
            padding: 20px;
            display: inline-block;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .report-section {
            margin-bottom: 30px;
            page-break-inside: avoid;
        }
        
        .report-section h2 {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .report-section h3 {
            color: #6366f1;
            margin: 15px 0 10px 0;
            font-size: 1.1rem;
            border-bottom: 2px solid #e0e7ff;
            padding-bottom: 5px;
        }
        
        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .report-table th {
            background: #f3f4f6;
            padding: 10px;
            text-align: left;
            border: 1px solid #ddd;
            font-weight: 600;
        }
        
        .report-table td {
            padding: 10px;
            border: 1px solid #ddd;
        }
        
        .report-table tr:nth-child(even) {
            background: #f9fafb;
        }
        
        .close-report-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ef4444;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            z-index: 10001;
        }
        
        .print-btn {
            position: fixed;
            top: 20px;
            right: 140px;
            background: #6366f1;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            z-index: 10001;
        }

        /* Print styles */
        @media print {
            body {
                background: white !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            /* Hide everything by default */
            header, .dashboard, .container > *, footer, .action-buttons {
                display: none !important;
            }
            
            /* Hide all buttons in report */
            .close-report-btn, .print-btn {
                display: none !important;
            }
            
            /* Only show the report */
            .print-report {
                display: block !important;
                position: relative !important;
                padding: 0 !important;
                background: white !important;
            }
            
            .print-report-content {
                box-shadow: none !important;
                padding: 20px !important;
                margin: 0 !important;
            }
            
            .report-section {
                page-break-inside: avoid;
            }
            
            .report-header {
                border-bottom: 3px solid #6366f1 !important;
            }
            
            .logo-circle {
                background: white !important;
                border: 2px solid #e5e7eb !important;
                box-shadow: none !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            .report-section h2 {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            .report-table {
                page-break-inside: auto;
            }
            
            .report-table tr {
                page-break-inside: avoid;
                page-break-after: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 15px;">
                <div style="background: white; border-radius: 50%; padding: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                    <img src="mono.png" alt="Logo" style="height: 80px; display: block;">
                </div>
                <div>
                    <h1 style="margin: 0;">üèóÔ∏è Advanced Concrete Mix Design Dashboard</h1>
                    <p style="margin: 8px 0 0 0;">Professional Mix Design with SCMs, Fine Aggregate Alternatives & Chemical Admixtures</p>
                </div>
            </div>
            
            <div class="action-buttons" style="display: flex; gap: 12px; justify-content: center; margin-top: 20px; flex-wrap: wrap;">
                <button class="action-btn" onclick="saveMix()" style="background: linear-gradient(135deg, #4caf50, #388e3c); color: white; padding: 12px 28px; border: none; border-radius: 25px; font-weight: 600; cursor: pointer; font-size: 0.95rem;">üíæ Save Mix</button>
                <button class="action-btn" onclick="loadMix()" style="background: linear-gradient(135deg, #2196f3, #1565c0); color: white; padding: 12px 28px; border: none; border-radius: 25px; font-weight: 600; cursor: pointer; font-size: 0.95rem;">üìÇ Load Mix</button>
                <button class="action-btn" onclick="compareMix()" style="background: linear-gradient(135deg, #ff9800, #f57c00); color: white; padding: 12px 28px; border: none; border-radius: 25px; font-weight: 600; cursor: pointer; font-size: 0.95rem;">‚öñÔ∏è Compare</button>
                <button class="action-btn" onclick="exportToPDF()" style="background: linear-gradient(135deg, #e91e63, #c2185b); color: white; padding: 12px 28px; border: none; border-radius: 25px; font-weight: 600; cursor: pointer; font-size: 0.95rem;">üìÑ Generate Report</button>
                <button class="action-btn" onclick="generateQR()" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2); color: white; padding: 12px 28px; border: none; border-radius: 25px; font-weight: 600; cursor: pointer; font-size: 0.95rem;">üì± Share QR</button>
            </div>
        </header>

        <div class="dashboard">
            <!-- Concrete Type Selection -->
            <div class="card preset-card">
                <h2>üéØ Concrete Type & Strength</h2>
                
                <div class="form-group">
                    <label>üéØ Quick Preset Type</label>
                    <select id="presetType" onchange="loadPreset(this.value)" style="background: #f0f9ff; color: #1e40af; border: 2px solid #667eea; font-weight: 700; padding: 10px;">
                        <option value="" style="color: #666;">-- Select Concrete Type --</option>
                        <option value="normal" style="color: #1e40af;">üè¢ Normal Concrete</option>
                        <option value="hpc" style="color: #1e40af;">‚ö° High-Performance (HPC)</option>
                        <option value="uhpc" style="color: #1e40af;">üíé Ultra-High Performance (UHPC)</option>
                        <option value="scc" style="color: #1e40af;">üåä Self-Compacting (SCC)</option>
                        <option value="mass" style="color: #1e40af;">üèîÔ∏è Mass Concrete</option>
                        <option value="marine" style="color: #1e40af;">üåä Marine Concrete</option>
                        <option value="foam" style="color: #1e40af;">ü´ß Foam Concrete</option>
                        <option value="fiber" style="color: #1e40af;">üßµ Fiber Reinforced</option>
                        <option value="geopolymer" style="color: #1e40af;">‚ôªÔ∏è Geopolymer</option>
                        <option value="pervious" style="color: #1e40af;">üíß Pervious Concrete</option>
                        <option value="lightweight" style="color: #1e40af;">ü™∂ Lightweight</option>
                        <option value="recycled" style="color: #1e40af;">‚ôªÔ∏è Recycled Aggregate</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Concrete Grade</label>
                    <select id="concreteGrade" onchange="updateFromGrade()">
                        <option value="15">M15 (15 MPa)</option>
                        <option value="20">M20 (20 MPa)</option>
                        <option value="25">M25 (25 MPa)</option>
                        <option value="30" selected>M30 (30 MPa)</option>
                        <option value="35">M35 (35 MPa)</option>
                        <option value="40">M40 (40 MPa)</option>
                        <option value="50">M50 (50 MPa)</option>
                        <option value="60">M60 (60 MPa)</option>
                        <option value="70">M70 (70 MPa)</option>
                        <option value="80">M80 (80 MPa)</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                <div class="form-group" id="customStrengthGroup" style="display: none;">
                    <label>Custom Target Strength (MPa)</label>
                    <input type="number" id="targetStrength" value="30" min="10" max="120" onchange="calculateMix()">
                </div>
                <div class="form-group">
                    <label>Exposure Condition</label>
                    <select id="exposure" onchange="calculateMix()">
                        <option value="mild">Mild (Interior, Dry)</option>
                        <option value="moderate" selected>Moderate (Sheltered from Rain)</option>
                        <option value="severe">Severe (Exposed to Weather)</option>
                        <option value="very-severe">Very Severe (Coastal, Chemical)</option>
                        <option value="marine">Marine/Coastal Splash Zone</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Standard Deviation (MPa) <span class="label-info">Quality Control</span></label>
                    <input type="number" id="stdDev" value="5.0" step="0.1" min="2.0" max="10.0" onchange="calculateMix()">
                </div>
            </div>

            <!-- W/C Ratio Control -->
            <div class="card">
                <h2>üíß Water-Cement Ratio Control</h2>
                <div class="form-group">
                    <label>
                        W/C Ratio Mode
                        <label class="toggle-switch">
                            <input type="checkbox" id="manualWC" onchange="toggleWCMode()">
                            <span class="toggle-slider"></span>
                        </label>
                        <span id="wcModeLabel" style="margin-left: 10px; font-weight: 600; color: #667eea;">Auto</span>
                    </label>
                </div>
                <div id="autoWCInfo" class="info-box" style="margin-top: 10px;">
                    <p><strong>Auto Mode:</strong> W/C ratio calculated based on target strength and exposure conditions per ACI guidelines.</p>
                </div>
                <div id="manualWCControl" style="display: none;">
                    <div class="form-group">
                        <label>Manual W/C Ratio <span class="label-info">Typical: 0.35-0.55</span></label>
                        <input type="number" id="manualWCValue" value="0.45" step="0.01" min="0.25" max="0.70" onchange="calculateMix()">
                    </div>
                    <div class="warning-box">
                        ‚ö†Ô∏è Ensure manual W/C ratio meets exposure requirements and achieves target strength.
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label>Maximum Aggregate Size (mm)</label>
                    <select id="maxAggSize" onchange="calculateMix()">
                        <option value="10">10 mm</option>
                        <option value="20" selected>20 mm</option>
                        <option value="40">40 mm</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Workability (Slump in mm)</label>
                    <select id="slump" onchange="calculateMix()">
                        <option value="25">Very Low (25-50 mm) - Pavement</option>
                        <option value="75">Low (50-100 mm) - Foundations</option>
                        <option value="125" selected>Medium (100-150 mm) - Slabs, Beams</option>
                        <option value="175">High (150-200 mm) - Columns</option>
                        <option value="225">Very High (>200 mm) - SCC/Pumping</option>
                    </select>
                </div>
            </div>

            <!-- Cement Replacements (SCMs) -->
            <div class="card scm-card">
                <h2>üî¨ Supplementary Cementitious Materials</h2>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="useFlyAsh" onchange="toggleSCM('flyAsh')">
                    <label for="useFlyAsh">Fly Ash</label>
                </div>
                
                <div id="flyAshOptions" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #ff6b6b;">
                    <div class="form-group">
                        <label>Fly Ash Type</label>
                        <select id="flyAshType" onchange="calculateMix()">
                            <option value="classF">Class F (Low Calcium, Pozzolanic)</option>
                            <option value="classC">Class C (High Calcium, Cementitious)</option>
                        </select>
                        <span class="label-benefit">‚úì Improves durability, reduces heat</span>
                    </div>
                    <div class="form-group">
                        <label>Replacement % <span class="label-info">Typical: 15-35%</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="flyAshPercent" min="10" max="40" value="25" step="5" oninput="updateSliderValue('flyAsh'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value scm-value" id="flyAshValue">25%</span>
                    </div>
                    <div class="form-group">
                        <label>Specific Gravity</label>
                        <input type="number" id="flyAshSG" value="2.3" step="0.01" min="2.0" max="2.8" onchange="calculateMix()">
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="useGGBS" onchange="toggleSCM('ggbs')">
                    <label for="useGGBS">GGBS (Slag Cement)</label>
                </div>
                
                <div id="ggbsOptions" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #ff6b6b;">
                    <div class="form-group">
                        <label>Replacement % <span class="label-info">Typical: 30-70%</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="ggbsPercent" min="25" max="75" value="50" step="5" oninput="updateSliderValue('ggbs'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value scm-value" id="ggbsValue">50%</span>
                        <span class="label-benefit">‚úì Excellent durability, low heat, sulfate resistant</span>
                    </div>
                    <div class="form-group">
                        <label>Specific Gravity</label>
                        <input type="number" id="ggbsSG" value="2.90" step="0.01" min="2.80" max="3.00" onchange="calculateMix()">
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="useSilicaFume" onchange="toggleSCM('silicaFume')">
                    <label for="useSilicaFume">Silica Fume (Microsilica)</label>
                </div>
                
                <div id="silicaFumeOptions" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #ff6b6b;">
                    <div class="form-group">
                        <label>Replacement % <span class="label-info">Typical: 5-10%</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="silicaFumePercent" min="3" max="15" value="7" step="1" oninput="updateSliderValue('silicaFume'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value scm-value" id="silicaFumeValue">7%</span>
                        <span class="label-benefit">‚úì Very high strength, ultra-low permeability</span>
                    </div>
                    <div class="form-group">
                        <label>Specific Gravity</label>
                        <input type="number" id="silicaFumeSG" value="2.25" step="0.01" min="2.15" max="2.35" onchange="calculateMix()">
                    </div>
                    <div class="warning-box">‚ö†Ô∏è Requires superplasticizer for proper dispersion</div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="useMetakaolin" onchange="toggleSCM('metakaolin')">
                    <label for="useMetakaolin">Metakaolin</label>
                </div>
                
                <div id="metakaolinOptions" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #ff6b6b;">
                    <div class="form-group">
                        <label>Replacement % <span class="label-info">Typical: 8-15%</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="metakaolinPercent" min="5" max="20" value="10" step="1" oninput="updateSliderValue('metakaolin'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value scm-value" id="metakaolinValue">10%</span>
                        <span class="label-benefit">‚úì Enhanced durability, reduced efflorescence</span>
                    </div>
                    <div class="form-group">
                        <label>Specific Gravity</label>
                        <input type="number" id="metakaolinSG" value="2.55" step="0.01" min="2.50" max="2.65" onchange="calculateMix()">
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="useRHA" onchange="toggleSCM('rha')">
                    <label for="useRHA">Rice Husk Ash</label>
                </div>
                
                <div id="rhaOptions" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #ff6b6b;">
                    <div class="form-group">
                        <label>Replacement % <span class="label-info">Typical: 10-15%</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="rhaPercent" min="5" max="20" value="12" step="1" oninput="updateSliderValue('rha'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value scm-value" id="rhaValue">12%</span>
                        <span class="label-benefit">‚úì Sustainable, good pozzolanic activity</span>
                    </div>
                    <div class="form-group">
                        <label>Specific Gravity</label>
                        <input type="number" id="rhaSG" value="2.15" step="0.01" min="2.00" max="2.30" onchange="calculateMix()">
                    </div>
                </div>
            </div>

            <!-- Fine Aggregate Alternatives -->
            <div class="card aggregate-card">
                <h2>ü™® Fine Aggregate Alternatives</h2>
                
                <div class="form-group">
                    <label>Primary Fine Aggregate Type</label>
                    <select id="fineAggType" onchange="updateFineAggProperties(); calculateMix()">
                        <option value="natural">Natural River/Pit Sand</option>
                        <option value="msand">Manufactured Sand (M-Sand)</option>
                        <option value="mixed">Mixed (50% Natural + 50% M-Sand)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Fine Aggregate Specific Gravity</label>
                    <input type="number" id="fineSG" value="2.65" step="0.01" min="2.5" max="2.85" onchange="calculateMix()">
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="useQuarryDust" onchange="toggleFineAggReplacement('quarryDust')">
                    <label for="useQuarryDust">Add Quarry Dust</label>
                </div>
                
                <div id="quarryDustOptions" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #06d6a0;">
                    <div class="form-group">
                        <label>Quarry Dust % <span class="label-info">Max: 50%</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="quarryDustPercent" min="10" max="50" value="30" step="5" oninput="updateSliderValue('quarryDust'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value agg-value" id="quarryDustValue">30%</span>
                        <span class="label-benefit">‚úì Improves cohesion, reduces segregation</span>
                    </div>
                    <div class="form-group">
                        <label>Specific Gravity</label>
                        <input type="number" id="quarryDustSG" value="2.68" step="0.01" min="2.50" max="2.80" onchange="calculateMix()">
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="useStoneDust" onchange="toggleFineAggReplacement('stoneDust')">
                    <label for="useStoneDust">Add Stone Dust</label>
                </div>
                
                <div id="stoneDustOptions" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #06d6a0;">
                    <div class="form-group">
                        <label>Stone Dust % <span class="label-info">Max: 40%</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="stoneDustPercent" min="10" max="40" value="25" step="5" oninput="updateSliderValue('stoneDust'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value agg-value" id="stoneDustValue">25%</span>
                        <span class="label-benefit">‚úì Fills voids, improves compaction</span>
                    </div>
                    <div class="form-group">
                        <label>Specific Gravity</label>
                        <input type="number" id="stoneDustSG" value="2.70" step="0.01" min="2.55" max="2.80" onchange="calculateMix()">
                    </div>
                </div>

                <div class="form-group">
                    <label>Total Fine Aggregate (% of Total Aggregate)</label>
                    <input type="number" id="fineAggPercent" value="38" min="25" max="50" step="1" onchange="calculateMix()">
                </div>

                <div class="form-group">
                    <label>Coarse Aggregate Specific Gravity</label>
                    <input type="number" id="coarseSG" value="2.70" step="0.01" min="1.0" max="2.9" onchange="calculateMix()">
                </div>

                <!-- Coarse Aggregate Replacements -->
                <div class="checkbox-group">
                    <input type="checkbox" id="useRCA" onchange="toggleCoarseAggReplacement('rca')">
                    <label for="useRCA">Recycled Concrete Aggregate (RCA)</label>
                </div>
                
                <div id="rcaOptions" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #06d6a0;">
                    <div class="form-group">
                        <label>RCA Replacement % <span class="label-info">Standard: 20-100%</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="rcaPercent" min="20" max="100" value="50" step="10" oninput="updateSliderValue('rca'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value agg-value" id="rcaValue">50%</span>
                        <span class="label-benefit">‚úì Sustainable, reduces landfill waste, 85-95% strength of natural</span>
                    </div>
                    <div class="form-group">
                        <label>RCA Specific Gravity <span class="label-info">Typical: 2.40-2.60</span></label>
                        <input type="number" id="rcaSG" value="2.50" step="0.01" min="2.30" max="2.65" onchange="calculateMix()">
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="useRecycledBrick" onchange="toggleCoarseAggReplacement('recycledBrick')">
                    <label for="useRecycledBrick">Recycled Brick Aggregate</label>
                </div>
                
                <div id="recycledBrickOptions" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #06d6a0;">
                    <div class="form-group">
                        <label>Brick Aggregate % <span class="label-info">Max: 50% (structural)</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="recycledBrickPercent" min="10" max="50" value="30" step="5" oninput="updateSliderValue('recycledBrick'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value agg-value" id="recycledBrickValue">30%</span>
                        <span class="label-benefit">‚úì Lightweight, good thermal insulation, higher water absorption</span>
                    </div>
                    <div class="form-group">
                        <label>Brick Aggregate SG <span class="label-info">Typical: 1.90-2.20</span></label>
                        <input type="number" id="recycledBrickSG" value="2.00" step="0.01" min="1.80" max="2.30" onchange="calculateMix()">
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="useLightweightAgg" onchange="toggleCoarseAggReplacement('lightweightAgg')">
                    <label for="useLightweightAgg">Lightweight Aggregate</label>
                </div>
                
                <div id="lightweightAggOptions" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #06d6a0;">
                    <div class="form-group">
                        <label>Lightweight Aggregate Type</label>
                        <select id="lightweightAggType" onchange="updateLightweightAggSG()">
                            <option value="expanded-clay">Expanded Clay (LECA)</option>
                            <option value="expanded-shale">Expanded Shale</option>
                            <option value="pumice">Pumice</option>
                            <option value="perlite">Perlite</option>
                            <option value="vermiculite">Vermiculite</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Lightweight Agg % <span class="label-info">Typical: 50-100%</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="lightweightAggPercent" min="30" max="100" value="100" step="10" oninput="updateSliderValue('lightweightAgg'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value agg-value" id="lightweightAggValue">100%</span>
                        <span class="label-benefit">‚úì Reduced dead load, good insulation, density: 800-1800 kg/m¬≥</span>
                    </div>
                    <div class="form-group">
                        <label>Lightweight Agg SG <span class="label-info">Range: 0.60-1.80</span></label>
                        <input type="number" id="lightweightAggSG" value="1.60" step="0.05" min="0.50" max="2.00" onchange="calculateMix()">
                    </div>
                </div>
            </div>

            <!-- Chemical Admixtures -->
            <div class="card">
                <h2>‚öóÔ∏è Chemical Admixtures</h2>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="useSuperplasticizer" onchange="toggleSuperplasticizer()">
                    <label for="useSuperplasticizer">Superplasticizer (HRWR)</label>
                </div>
                
                <div id="superplasticizerOptions" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #2196f3;">
                    <div class="form-group">
                        <label>Superplasticizer Type</label>
                        <select id="superplasticizerType" onchange="updateWaterReduction()">
                            <option value="PCE">PCE Based (Polycarboxylate Ether)</option>
                            <option value="SNF">SNF Based (Sulphonated Naphthalene)</option>
                            <option value="SMF">SMF Based (Sulphonated Melamine)</option>
                            <option value="ligno">Lignosulfonate Based</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Dosage (% by cementitious weight) <span class="label-info">Typical: 0.5-2.0%</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="superplasticizerDosage" value="1.2" step="0.1" min="0.1" max="3.5" oninput="updateSliderValue('superplasticizer'); updateWaterReduction()" style="width: 100%;">
                        </div>
                        <span class="slider-value" id="superplasticizerValue" style="background: linear-gradient(135deg, #2196f3, #1565c0);">1.2%</span>
                    </div>
                    <div class="form-group">
                        <label>Water Reduction <span class="label-info">(Auto-calculated)</span></label>
                        <input type="number" id="waterReduction" value="25" disabled>
                        <span class="benefit-badge" id="waterReductionBadge">25% reduction</span>
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="useRetarder" onchange="toggleAdmixture('retarder')">
                    <label for="useRetarder">Retarder (Hot Weather)</label>
                </div>

                <div id="retarderOptions" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #ff9800;">
                    <div class="form-group">
                        <label>Dosage (% by cementitious weight) <span class="label-info">Typical: 0.2-0.5%</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="retarderDosage" value="0.3" step="0.05" min="0.1" max="0.8" oninput="updateSliderValue('retarder'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value" id="retarderValue" style="background: linear-gradient(135deg, #ff9800, #f57c00);">0.3%</span>
                        <span class="label-benefit">‚úì Delays setting time 2-4 hours</span>
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="useAccelerator" onchange="toggleAdmixture('accelerator')">
                    <label for="useAccelerator">Accelerator (Cold Weather)</label>
                </div>

                <div id="acceleratorOptions" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #4caf50;">
                    <div class="form-group">
                        <label>Dosage (% by cementitious weight) <span class="label-info">Typical: 1-2%</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="acceleratorDosage" value="1.5" step="0.1" min="0.5" max="3.0" oninput="updateSliderValue('accelerator'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value" id="acceleratorValue" style="background: linear-gradient(135deg, #4caf50, #388e3c);">1.5%</span>
                        <span class="label-benefit">‚úì Speeds setting time, early strength gain</span>
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="useAirEntraining" onchange="toggleAirEntraining()">
                    <label for="useAirEntraining">Air-Entraining Agent</label>
                </div>

                <div id="airEntrainingOptions" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #00bcd4;">
                    <div class="form-group">
                        <label>Target Air Content (%) <span class="label-info">Typical: 4-7%</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="airContent" value="5.5" step="0.5" min="3" max="9" oninput="updateSliderValue('airContent'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value" id="airContentValue" style="background: linear-gradient(135deg, #00bcd4, #0097a7);">5.5%</span>
                        <span class="label-benefit">‚úì Improved freeze-thaw resistance</span>
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="useWaterproofing" onchange="toggleAdmixture('waterproofing')">
                    <label for="useWaterproofing">Waterproofing Agent</label>
                </div>

                <div id="waterproofingOptions" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #9c27b0;">
                    <div class="form-group">
                        <label>Dosage (% by cementitious weight) <span class="label-info">Typical: 1-3%</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="waterproofingDosage" value="2.0" step="0.1" min="0.5" max="4.0" oninput="updateSliderValue('waterproofing'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value" id="waterproofingValue" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2);">2.0%</span>
                        <span class="label-benefit">‚úì Reduced permeability, water resistance</span>
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="useViscosity" onchange="toggleAdmixture('viscosity')">
                    <label for="useViscosity">Viscosity Modifying Agent (VMA)</label>
                </div>

                <div id="viscosityOptions" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #e91e63;">
                    <div class="form-group">
                        <label>Dosage (% by cementitious weight) <span class="label-info">Typical: 0.05-0.3%</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="viscosityDosage" value="0.15" step="0.05" min="0.03" max="0.5" oninput="updateSliderValue('viscosity'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value" id="viscosityValue" style="background: linear-gradient(135deg, #e91e63, #c2185b);">0.15%</span>
                        <span class="label-benefit">‚úì Improved cohesion, reduced segregation</span>
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="useFoamAgent" onchange="toggleAdmixture('foamAgent')">
                    <label for="useFoamAgent">Foaming Agent (For Foam Concrete)</label>
                </div>

                <div id="foamAgentOptions" style="display: none; background: #fff3e0; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #ffa726;">
                    <div class="info-box" style="margin: 0 0 15px 0; background: #e3f2fd; border-left: 4px solid #2196f3; padding: 10px;">
                        <p style="margin: 0 0 8px 0; font-size: 0.9rem; font-weight: bold; color: #1565c0;">üìã Foam Concrete Standards:</p>
                        <p style="margin: 0; font-size: 0.8rem; line-height: 1.5;">
                        <strong>ASTM C796</strong> - Foaming Agents | <strong>ACI 523.3R</strong> - Cellular Concrete Guide<br>
                        <strong>BS 8110</strong> - Structural Use | <strong>IS 2185 (Part 4)</strong> - Masonry Units<br><br>
                        <strong>Density Classifications:</strong><br>
                        ‚Ä¢ 300-600 kg/m¬≥: Non-structural (Insulation, thermal barrier)<br>
                        ‚Ä¢ 600-900 kg/m¬≥: Lightweight fill (Roof fill, void filling, trench reinstatement)<br>
                        ‚Ä¢ 900-1200 kg/m¬≥: Masonry units (Blocks, partition walls)<br>
                        ‚Ä¢ 1200-1600 kg/m¬≥: Structural lightweight (Low-rise, composite structures)<br>
                        ‚Ä¢ 1600-1800 kg/m¬≥: Load-bearing (Designed structures, slabs)</p>
                    </div>
                    <div class="form-group">
                        <label>Target Density (kg/m¬≥) <span class="label-info">Range: 400-1800 kg/m¬≥</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="foamDensity" value="1000" step="50" min="400" max="1800" oninput="updateSliderValue('foamDensity'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value" id="foamDensityValue" style="background: linear-gradient(135deg, #ffa726, #fb8c00);">1000 kg/m¬≥</span>
                        <span class="label-benefit" id="foamDensityCategory">‚úì Light - Blocks, Roof fill</span>
                    </div>
                    <div class="form-group">
                        <label>Foam Agent Dosage (%) <span class="label-info">Protein or Synthetic based</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="foamAgentDosage" value="3" step="0.5" min="1" max="8" oninput="updateSliderValue('foamAgent'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value" id="foamAgentValue" style="background: linear-gradient(135deg, #ffa726, #fb8c00);">3%</span>
                    </div>
                    <div class="form-group">
                        <label>Foam Type</label>
                        <select id="foamType" onchange="calculateMix(false)">
                            <option value="protein">Protein-based (Natural)</option>
                            <option value="synthetic" selected>Synthetic (Chemical)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Foam Expansion Ratio <span class="label-info">Volume of foam produced per unit of foam agent</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="foamExpansionRatio" value="20" step="1" min="10" max="30" oninput="updateSliderValue('foamExpansion'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value" id="foamExpansionValue" style="background: linear-gradient(135deg, #ffa726, #fb8c00);">20:1</span>
                        <span class="label-benefit">‚úì Higher ratio = Lower density & cost</span>
                    </div>
                    <div class="form-group">
                        <label>Target Air Content (Void %) <span class="label-info">Typical: 40-80%</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="foamAirContent" value="60" step="5" min="40" max="80" oninput="updateSliderValue('foamAir'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value" id="foamAirValue" style="background: linear-gradient(135deg, #ffa726, #fb8c00);">60%</span>
                        <span class="label-benefit" id="foamAirBenefit">‚úì Medium void content - Balanced properties</span>
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="useFibers" onchange="toggleAdmixture('fibers')">
                    <label for="useFibers">Fibers (Steel/Polypropylene/Glass)</label>
                </div>

                <div id="fibersOptions" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #f857a6;">
                    <div class="form-group">
                        <label>Fiber Type</label>
                        <select id="fiberType" onchange="calculateMix(false)">
                            <option value="steel">Steel Fibers</option>
                            <option value="polypropylene">Polypropylene (PP) Fibers</option>
                            <option value="glass">Glass Fibers (GFRC)</option>
                            <option value="carbon">Carbon Fibers</option>
                            <option value="basalt">Basalt Fibers</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Fiber Dosage (kg/m¬≥) <span class="label-info">Steel: 20-80 kg/m¬≥, PP: 0.5-2 kg/m¬≥</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="fiberDosage" value="30" step="5" min="5" max="100" oninput="updateSliderValue('fiber'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value" id="fiberValue" style="background: linear-gradient(135deg, #f857a6, #ff5858);">30 kg/m¬≥</span>
                        <span class="label-benefit">‚úì Crack control, impact resistance, ductility</span>
                    </div>
                </div>
            </div>

            <!-- Weather & Aesthetic Properties (Combined) -->
            <div class="card" style="border: 2px solid #ff9800;">
                <h2 style="background: linear-gradient(90deg, #ff9800, #e91e63); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; border-image: linear-gradient(90deg, #ff9800, #e91e63) 1;">üå°Ô∏èüé® Weather & Aesthetics</h2>
                
                <div class="form-group">
                    <label>Ambient Temperature (¬∞C)</label>
                    <div style="margin: 15px 0;">
                        <input type="range" id="ambientTemp" value="25" step="1" min="-5" max="45" oninput="updateSliderValue('ambientTemp'); calculateMix(false)" style="width: 100%;">
                    </div>
                    <span class="slider-value" id="ambientTempValue" style="background: linear-gradient(135deg, #ff9800, #f57c00);">25¬∞C</span>
                </div>
                
                <div class="form-group">
                    <label>Weather Condition</label>
                    <select id="weatherCondition" onchange="calculateMix(false)">
                        <option value="normal">Normal (15-30¬∞C)</option>
                        <option value="hot">Hot Weather (>30¬∞C)</option>
                        <option value="cold">Cold Weather (<10¬∞C)</option>
                        <option value="humid">High Humidity</option>
                        <option value="windy">Windy/Dry</option>
                    </select>
                </div>
                
                <div id="weatherWarning" style="display: none;" class="warning-box"></div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="useWhiteCement" onchange="calculateMix(false)">
                    <label for="useWhiteCement">White Cement (for colored concrete)</label>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="usePigment" onchange="toggleAdmixture('pigment')">
                    <label for="usePigment">Add Color Pigment</label>
                </div>
                
                <div id="pigmentOptions" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px; border: 2px solid #e91e63;">
                    <div class="form-group">
                        <label>Pigment Color</label>
                        <select id="pigmentColor" onchange="calculateMix(false)">
                            <option value="red">Red/Terracotta</option>
                            <option value="yellow">Yellow/Buff</option>
                            <option value="brown">Brown/Tan</option>
                            <option value="green">Green</option>
                            <option value="blue">Blue</option>
                            <option value="black">Black/Charcoal</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Pigment Dosage (% by cement weight) <span class="label-info">Typical: 2-8%</span></label>
                        <div style="margin: 15px 0;">
                            <input type="range" id="pigmentDosage" value="4" step="0.5" min="1" max="10" oninput="updateSliderValue('pigment'); calculateMix(false)" style="width: 100%;">
                        </div>
                        <span class="slider-value" id="pigmentValue" style="background: linear-gradient(135deg, #e91e63, #c2185b);">4%</span>
                    </div>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="useExposedAggregate" onchange="calculateMix(false)">
                    <label for="useExposedAggregate">Exposed Aggregate Finish</label>
                </div>
            </div>

            <!-- Cost Calculator -->
            <div class="card" style="border: 2px solid #4caf50;">
                <h2 style="background: linear-gradient(90deg, #4caf50, #388e3c); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; border-image: linear-gradient(90deg, #4caf50, #388e3c) 1;">üí∞ Cost Calculator</h2>
                
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 8px; margin-bottom: 12px;">
                    <div>
                        <div style="font-size: 0.75rem; font-weight: 700; color: #2e7d32;">üìç Auto-Update Prices</div>
                        <div id="priceStatus" style="font-size: 0.65rem; color: #666; margin-top: 2px;">Click update button</div>
                    </div>
                    <button onclick="fetchMarketPrices()" style="background: #4caf50; color: white; border: none; padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 0.75rem; font-weight: 600;">üîÑ Update</button>
                </div>
                
                <div class="form-group">
                    <label>Location/Region</label>
                    <select id="location" onchange="fetchMarketPrices()">
                        <option value="pakistan">Pakistan</option>
                        <option value="india">India</option>
                        <option value="usa">United States</option>
                        <option value="uk">United Kingdom</option>
                        <option value="uae">UAE</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>OPC Cement Cost (per kg)</label>
                    <input type="number" id="cementCost" value="29" step="0.5" min="0" onchange="calculateMix(false)">
                </div>
                <div class="form-group">
                    <label>SCM Cost (per kg) <span class="label-info">Avg for Fly Ash/GGBS</span></label>
                    <input type="number" id="scmCost" value="2" step="0.5" min="0" onchange="calculateMix(false)">
                </div>
                <div class="form-group">
                    <label>Fine Aggregate Cost (per kg)</label>
                    <input type="number" id="fineAggCost" value="1.5" step="0.1" min="0" onchange="calculateMix(false)">
                </div>
                <div class="form-group">
                    <label>Coarse Aggregate Cost (per kg)</label>
                    <input type="number" id="coarseAggCost" value="1.2" step="0.1" min="0" onchange="calculateMix(false)">
                </div>
                <div class="form-group">
                    <label>Admixture Cost (per kg)</label>
                    <input type="number" id="admixtureCost" value="150" step="10" min="0" onchange="calculateMix(false)">
                </div>
                <div class="form-group">
                    <label>Currency Symbol</label>
                    <select id="currencySymbol" onchange="calculateMix(false)">
                        <option value="‚Ç®">‚Ç® (Pakistani Rupee)</option>
                        <option value="$">$ (US Dollar)</option>
                        <option value="‚Ç¨">‚Ç¨ (Euro)</option>
                        <option value="¬£">¬£ (British Pound)</option>
                        <option value="‚Çπ">‚Çπ (Indian Rupee)</option>
                    </select>
                </div>
            </div>

            <!-- Material Properties -->
            <div class="card">
                <h2>üîß Cement & Parameters</h2>
                <div class="form-group">
                    <label>Primary Cement Type</label>
                    <select id="cementType" onchange="calculateMix()">
                        <option value="OPC43">OPC 43 Grade</option>
                        <option value="OPC53" selected>OPC 53 Grade</option>
                        <option value="PPC">Portland Pozzolana Cement</option>
                        <option value="PSC">Portland Slag Cement</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Cement Specific Gravity</label>
                    <input type="number" id="cementSG" value="3.15" step="0.01" min="2.8" max="3.3" onchange="calculateMix()">
                </div>
                <div class="form-group">
                    <label>Type of Placement</label>
                    <select id="placement" onchange="calculateMix()">
                        <option value="manual">Manual (Wheelbarrow)</option>
                        <option value="pump" selected>Pump/Conveyor</option>
                        <option value="tremie">Tremie (Underwater)</option>
                        <option value="scc">Self-Compacting</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Degree of Quality Control</label>
                    <select id="qualityControl" onchange="calculateMix()">
                        <option value="fair">Fair (œÉ = 6-8 MPa)</option>
                        <option value="good" selected>Good (œÉ = 4-6 MPa)</option>
                        <option value="excellent">Excellent (œÉ = 2-4 MPa)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Volume to Calculate (m¬≥)</label>
                    <input type="number" id="volume" value="1" step="0.1" min="0.1" max="1000" onchange="calculateMix()">
                </div>
                <div class="form-group">
                    <label>Mixer Capacity (m¬≥) <span class="label-info">For batch calculation</span></label>
                    <input type="number" id="mixerCapacity" value="0.5" step="0.1" min="0.1" max="5" onchange="calculateMix(false)">
                </div>
                <button class="btn" onclick="calculateMix(true)">üî¨ Calculate Mix Design</button>
                <button class="btn" onclick="optimizeMix()" style="background: linear-gradient(135deg, #ffa726, #fb8c00); margin-top: 10px;">üéØ Optimize Mix</button>
            </div>

            <!-- Results -->
            <div class="card results-card" id="resultsCard" style="display: none;">
                <h2>üìä Mix Design Results</h2>
                
                <!-- Concrete Type Display -->
                <div style="text-align: center;">
                    <div class="concrete-type-badge" id="concreteTypeBadge">NORMAL CONCRETE</div>
                </div>

                <div class="results-grid">
                    <div class="result-item scm-highlight">
                        <div class="result-label">OPC Cement</div>
                        <div class="result-value" id="cementResult">0</div>
                        <div class="result-unit">kg/m¬≥</div>
                    </div>
                    <div class="result-item scm-highlight" id="scmResultItem" style="display: none;">
                        <div class="result-label" id="scmResultLabel">SCM</div>
                        <div class="result-value" id="scmResult">0</div>
                        <div class="result-unit">kg/m¬≥</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Total Cementitious</div>
                        <div class="result-value" id="totalCementResult">0</div>
                        <div class="result-unit">kg/m¬≥</div>
                    </div>
                    <div class="result-item highlight">
                        <div class="result-label">Water</div>
                        <div class="result-value" id="waterResult">0</div>
                        <div class="result-unit">kg/m¬≥</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Fine Aggregate</div>
                        <div class="result-value" id="fineResult">0</div>
                        <div class="result-unit">kg/m¬≥</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Coarse Aggregate</div>
                        <div class="result-value" id="coarseResult">0</div>
                        <div class="result-unit">kg/m¬≥</div>
                    </div>
                    <div class="result-item highlight">
                        <div class="result-label">W/C Ratio</div>
                        <div class="result-value" id="wcRatio">0</div>
                        <div class="result-unit"></div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Mix Strength</div>
                        <div class="result-value" id="mixStrength">0</div>
                        <div class="result-unit">MPa</div>
                    </div>
                </div>

                <!-- Concrete Type Information -->
                <div id="concreteTypeInfo">
                    <div class="concrete-type-box">
                        <h3>üéØ Concrete Type Classification</h3>
                        <div id="concreteTypeDetails"></div>
                    </div>
                </div>

                <div id="scmResults" style="display: none;">
                    <div class="scm-box">
                        <h3>üî¨ SCM Composition & Benefits</h3>
                        <div id="scmDetails"></div>
                    </div>
                </div>

                <div id="fineAggResults" style="display: none;">
                    <div class="scm-box" style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-left-color: #27ae60;">
                        <h3 style="color: #1b5e20;">ü™® Fine Aggregate Composition</h3>
                        <div id="fineAggDetails"></div>
                    </div>
                </div>

                <div id="coarseAggResults" style="display: none;">
                    <div class="scm-box" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); border-left-color: #f57c00;">
                        <h3 style="color: #e65100;">üèîÔ∏è Coarse Aggregate Composition</h3>
                        <div id="coarseAggDetails"></div>
                    </div>
                </div>

                <div id="admixtureResults" style="display: none;">
                    <div class="admixture-box">
                        <h3>üß™ Chemical Admixtures Used</h3>
                        <div id="admixtureDetails"></div>
                    </div>
                </div>

                <div class="mix-proportions">
                    <h3>Mix Proportions by Weight</h3>
                    <div class="proportion-text" id="proportions">1 : 0 : 0</div>
                    <p style="text-align: center; margin-top: 12px; color: #666; font-size: 0.95rem;" id="proportionBreakdown"></p>
                </div>

                <div class="info-box">
                    <h3>üìã For <span id="volumeDisplay">1</span> m¬≥ of Concrete</h3>
                    <p id="totalQuantities"></p>
                </div>

                <div id="sustainabilityInfo" style="display: none;">
                    <div class="info-box" style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-left-color: #4caf50;">
                        <h3 style="color: #2e7d32;">üå± Sustainability Impact</h3>
                        <p id="sustainabilityDetails" style="color: #2e7d32;"></p>
                    </div>
                </div>

                <!-- Cost Breakdown -->
                <div class="info-box" style="background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%); border-left-color: #fbc02d;">
                    <h3 style="color: #f57f17;">üí∞ Cost Breakdown (for <span id="costVolume">1</span> m¬≥)</h3>
                    <p id="costBreakdown" style="color: #f57f17;"></p>
                </div>

                <!-- Sustainability Score -->
                <div class="info-box" style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-left-color: #66bb6a;">
                    <h3 style="color: #2e7d32;">üåç Sustainability Score</h3>
                    <div id="sustainabilityScore"></div>
                </div>

                <!-- Strength Prediction -->
                <div class="concrete-type-box">
                    <h3>üìà Strength Development Prediction</h3>
                    <div id="strengthPrediction"></div>
                </div>

                <!-- Curing Schedule -->
                <div class="admixture-box">
                    <h3>‚è±Ô∏è Recommended Curing Schedule</h3>
                    <div id="curingSchedule"></div>
                </div>

                <!-- Batch Calculator -->
                <div class="mix-proportions">
                    <h3>üì¶ Batch Calculator</h3>
                    <div id="batchCalculator"></div>
                </div>

                <!-- Testing Schedule -->
                <div class="info-box" style="background: linear-gradient(135deg, #e1f5fe 0%, #b3e5fc 100%); border-left-color: #0288d1;">
                    <h3 style="color: #01579b;">üß™ Testing Schedule & Quality Control</h3>
                    <div id="testingSchedule"></div>
                </div>

                <!-- Durability Parameters -->
                <div class="concrete-type-box" style="background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%); border-left-color: #c2185b;">
                    <h3 style="color: #880e4f;">üõ°Ô∏è Durability Assessment</h3>
                    <div id="durabilityParams"></div>
                </div>

                <!-- Weather Recommendations -->
                <div id="weatherRecommendations" style="display: none;">
                    <div class="warning-box">
                        <h3 style="color: #c62828;">üå°Ô∏è Weather-Based Recommendations</h3>
                        <div id="weatherAdvice"></div>
                    </div>
                </div>

                <!-- Visual Charts -->
                <div class="info-box" style="background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); border-left-color: #8e24aa;">
                    <h3 style="color: #6a1b9a;">üìä Visual Analysis</h3>
                    <div id="visualCharts"></div>
                </div>
            </div>

            <!-- Comparison Tool -->
            <div class="card results-card" id="comparisonCard" style="display: none;">
                <h2>‚öñÔ∏è Mix Comparison</h2>
                <div id="comparisonResults"></div>
            </div>

            <!-- QR Code Display -->
            <div class="card results-card" id="qrCard" style="display: none; text-align: center;">
                <h2>üì± QR Code - Share This Mix</h2>
                <div id="qrCodeDisplay"></div>
                <p style="margin-top: 15px; color: #666;">Scan this QR code to share the mix design</p>
            </div>
        </div>

        <footer>
            <h4>üë®‚Äçüè´ Development Team</h4>
            <p><strong>Dr. Riaz Bhanbhro</strong> | Lead Developer</p>
            <p><strong>Dr. Mahboob Oad</strong> | Technical Advisor</p>
            <p><strong>Dr. Muneeb Memon</strong> | Research Consultant</p>
            <div class="copyright">
                <p><strong>üèõÔ∏è Quaid-e-Awam University of Engineering, Science & Technology</strong></p>
                <p>Civil Engineering Department</p>
                <p>¬© 2025 | All Rights Reserved</p>
                <p style="margin-top: 10px; font-size: 0.85rem;">
                    Educational Tool for Concrete Mix Design | Based on ACI Standards
                </p>
            </div>
        </footer>
    </div>

    <script>
        // Market Prices Database (Location-based pricing)
        const marketPrices = {
            pakistan: {
                name: 'Pakistan',
                currency: '‚Ç®',
                cement: 29,      // PKR per kg (1450 PKR per 50kg bag)
                scm: 6,          // PKR per kg
                fineAgg: 2.5,    // PKR per kg
                coarseAgg: 2.0,  // PKR per kg
                admixture: 300   // PKR per kg
            },
            india: {
                name: 'India',
                currency: '‚Çπ',
                cement: 8,       // INR per kg
                scm: 1.6,        // INR per kg
                fineAgg: 1.8,    // INR per kg
                coarseAgg: 1.5,  // INR per kg
                admixture: 240   // INR per kg
            },
            usa: {
                name: 'United States',
                currency: '$',
                cement: 0.17,    // USD per kg
                scm: 0.05,       // USD per kg
                fineAgg: 0.04,   // USD per kg
                coarseAgg: 0.03, // USD per kg
                admixture: 3.6   // USD per kg
            },
            uk: {
                name: 'United Kingdom',
                currency: '¬£',
                cement: 0.13,    // GBP per kg
                scm: 0.04,       // GBP per kg
                fineAgg: 0.03,   // GBP per kg
                coarseAgg: 0.025,// GBP per kg
                admixture: 3.0   // GBP per kg
            },
            uae: {
                name: 'UAE',
                currency: 'ÿØ.ÿ•',
                cement: 0.44,    // AED per kg
                scm: 0.12,       // AED per kg
                fineAgg: 0.12,   // AED per kg
                coarseAgg: 0.10, // AED per kg
                admixture: 11    // AED per kg
            }
        };

        // Fetch Market Prices
        function fetchMarketPrices() {
            const location = document.getElementById('location').value;
            const prices = marketPrices[location];
            
            if (!prices) return;

            document.getElementById('cementCost').value = prices.cement.toFixed(2);
            document.getElementById('scmCost').value = prices.scm.toFixed(2);
            document.getElementById('fineAggCost').value = prices.fineAgg.toFixed(2);
            document.getElementById('coarseAggCost').value = prices.coarseAgg.toFixed(2);
            document.getElementById('admixtureCost').value = prices.admixture.toFixed(0);
            document.getElementById('currencySymbol').value = prices.currency;
            
            const now = new Date();
            document.getElementById('priceStatus').innerHTML = `<strong>‚úì Updated:</strong> ${prices.name} - ${now.toLocaleTimeString()}`;
            
            calculateMix(false);
        }

        // Preset loading functions
        function loadPreset(type) {
            if (!type || type === '') return; // Don't load if blank selection
            
            // STEP 1: Uncheck ALL checkboxes
            const allCheckboxes = [
                'useFlyAsh', 'useGGBS', 'useSilicaFume', 'useMetakaolin', 'useRHA',
                'useSuperplasticizer', 'useAirEntraining', 'useRetarder', 'useAccelerator',
                'useViscosity', 'useFoamAgent', 'useFibers', 'useWaterproofing',
                'useWhiteCement', 'usePigment', 'useExposedAggregate',
                'useRCA', 'useRecycledBrick', 'useLightweightAgg',
                'useQuarryDust', 'useStoneDust'
            ];
            
            allCheckboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) checkbox.checked = false;
            });

            // STEP 2: Hide ALL options divs
            const allOptionDivs = [
                'flyAshOptions', 'ggbsOptions', 'silicaFumeOptions', 'metakaolinOptions', 'rhaOptions',
                'superplasticizerOptions', 'airEntrainingOptions', 'retarderOptions', 'acceleratorOptions',
                'waterproofingOptions', 'viscosityOptions', 'foamAgentOptions', 'fibersOptions', 'pigmentOptions',
                'rcaOptions', 'recycledBrickOptions', 'lightweightAggOptions',
                'quarryDustOptions', 'stoneDustOptions'
            ];
            
            allOptionDivs.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.style.display = 'none';
            });

            switch(type) {
                case 'normal':
                    // STANDARD: Normal concrete = 100% OPC, no SCMs required
                    document.getElementById('concreteGrade').value = '30';
                    document.getElementById('exposure').value = 'moderate';
                    document.getElementById('slump').value = '125';
                    // No materials selected - pure OPC concrete
                    break;

                case 'hpc':
                    // STANDARD: HPC requires SF or GGBS for dense microstructure + SP
                    document.getElementById('concreteGrade').value = '50';
                    document.getElementById('exposure').value = 'severe';
                    document.getElementById('slump').value = '175';
                    document.getElementById('useSilicaFume').checked = true;
                    document.getElementById('useGGBS').checked = true;
                    document.getElementById('useSuperplasticizer').checked = true;
                    toggleSCM('silicaFume');
                    toggleSCM('ggbs');
                    toggleSuperplasticizer();
                    document.getElementById('silicaFumePercent').value = '8';
                    document.getElementById('ggbsPercent').value = '25';
                    document.getElementById('superplasticizerType').value = 'PCE';
                    document.getElementById('superplasticizerDosage').value = '1.5';
                    break;

                case 'uhpc':
                    document.getElementById('concreteGrade').value = '70';
                    document.getElementById('exposure').value = 'very-severe';
                    document.getElementById('slump').value = '175';
                    document.getElementById('useSilicaFume').checked = true;
                    document.getElementById('useMetakaolin').checked = true;
                    document.getElementById('useSuperplasticizer').checked = true;
                    toggleSCM('silicaFume');
                    toggleSCM('metakaolin');
                    toggleSuperplasticizer();
                    document.getElementById('silicaFumePercent').value = '12';
                    document.getElementById('metakaolinPercent').value = '15';
                    document.getElementById('superplasticizerType').value = 'PCE';
                    document.getElementById('superplasticizerDosage').value = '2.5';
                    document.getElementById('fineAggType').value = 'msand';
                    break;

                case 'scc':
                    document.getElementById('concreteGrade').value = '35';
                    document.getElementById('exposure').value = 'moderate';
                    document.getElementById('slump').value = '225';
                    document.getElementById('placement').value = 'scc';
                    document.getElementById('useFlyAsh').checked = true;
                    document.getElementById('useSuperplasticizer').checked = true;
                    document.getElementById('useViscosity').checked = true;
                    toggleSCM('flyAsh');
                    toggleSuperplasticizer();
                    document.getElementById('flyAshPercent').value = '30';
                    document.getElementById('superplasticizerType').value = 'PCE';
                    document.getElementById('superplasticizerDosage').value = '2.0';
                    document.getElementById('fineAggPercent').value = '45';
                    break;

                case 'mass':
                    document.getElementById('concreteGrade').value = '25';
                    document.getElementById('exposure').value = 'moderate';
                    document.getElementById('slump').value = '75';
                    document.getElementById('useGGBS').checked = true;
                    document.getElementById('useFlyAsh').checked = true;
                    document.getElementById('useRetarder').checked = true;
                    toggleSCM('ggbs');
                    toggleSCM('flyAsh');
                    document.getElementById('ggbsPercent').value = '50';
                    document.getElementById('flyAshPercent').value = '20';
                    break;

                case 'marine':
                    document.getElementById('concreteGrade').value = '40';
                    document.getElementById('exposure').value = 'marine';
                    document.getElementById('slump').value = '125';
                    document.getElementById('useGGBS').checked = true;
                    document.getElementById('useSilicaFume').checked = true;
                    document.getElementById('useSuperplasticizer').checked = true;
                    toggleSCM('ggbs');
                    toggleSCM('silicaFume');
                    toggleSuperplasticizer();
                    document.getElementById('ggbsPercent').value = '55';
                    document.getElementById('silicaFumePercent').value = '7';
                    document.getElementById('superplasticizerDosage').value = '1.3';
                    break;

                case 'foam':
                    // STANDARD: Foam concrete = OPC + Foam Agent (Per ASTM C796, ACI 523.3R)
                    document.getElementById('concreteGrade').value = '10';
                    document.getElementById('exposure').value = 'mild';
                    document.getElementById('slump').value = '175';
                    document.getElementById('useFoamAgent').checked = true;
                    toggleAdmixture('foamAgent');
                    document.getElementById('foamDensity').value = '1000';
                    document.getElementById('foamAgentDosage').value = '3';
                    document.getElementById('foamExpansionRatio').value = '20';
                    document.getElementById('foamAirContent').value = '60';
                    document.getElementById('fineAggPercent').value = '100';
                    document.getElementById('maxAggSize').value = '10';
                    // Update slider displays
                    updateSliderValue('foamDensity');
                    updateSliderValue('foamAgent');
                    updateSliderValue('foamExpansion');
                    updateSliderValue('foamAir');
                    break;

                case 'fiber':
                    document.getElementById('concreteGrade').value = '40';
                    document.getElementById('exposure').value = 'severe';
                    document.getElementById('slump').value = '125';
                    document.getElementById('useFibers').checked = true;
                    document.getElementById('useSuperplasticizer').checked = true;
                    toggleAdmixture('fibers');
                    toggleSuperplasticizer();
                    document.getElementById('fiberType').value = 'steel';
                    document.getElementById('fiberDosage').value = '40';
                    document.getElementById('superplasticizerDosage').value = '1.0';
                    break;

                case 'geopolymer':
                    document.getElementById('concreteGrade').value = '35';
                    document.getElementById('exposure').value = 'severe';
                    document.getElementById('slump').value = '125';
                    document.getElementById('useFlyAsh').checked = true;
                    document.getElementById('useGGBS').checked = true;
                    document.getElementById('useSuperplasticizer').checked = true;
                    toggleSCM('flyAsh');
                    toggleSCM('ggbs');
                    toggleSuperplasticizer();
                    document.getElementById('flyAshPercent').value = '40';
                    document.getElementById('ggbsPercent').value = '35';
                    document.getElementById('superplasticizerDosage').value = '1.5';
                    break;

                case 'pervious':
                    document.getElementById('concreteGrade').value = '20';
                    document.getElementById('exposure').value = 'severe';
                    document.getElementById('slump').value = '75';
                    document.getElementById('useSuperplasticizer').checked = true;
                    toggleSuperplasticizer();
                    document.getElementById('superplasticizerDosage').value = '0.8';
                    document.getElementById('fineAggPercent').value = '10';
                    document.getElementById('maxAggSize').value = '20';
                    break;

                case 'lightweight':
                    // STANDARD: Lightweight concrete = lightweight aggregates (SCMs optional)
                    document.getElementById('concreteGrade').value = '25';
                    document.getElementById('exposure').value = 'moderate';
                    document.getElementById('slump').value = '125';
                    document.getElementById('useLightweightAgg').checked = true;
                    toggleCoarseAggReplacement('lightweightAgg');
                    document.getElementById('lightweightAggPercent').value = '100';
                    document.getElementById('coarseSG').value = '1.60';
                    break;

                case 'recycled':
                    // STANDARD: Recycled aggregate concrete with SCMs for strength enhancement
                    document.getElementById('concreteGrade').value = '30';
                    document.getElementById('exposure').value = 'moderate';
                    document.getElementById('slump').value = '125';
                    document.getElementById('useFlyAsh').checked = true;
                    document.getElementById('useSilicaFume').checked = true;
                    document.getElementById('useRCA').checked = true;
                    toggleSCM('flyAsh');
                    toggleSCM('silicaFume');
                    toggleCoarseAggReplacement('rca');
                    document.getElementById('flyAshPercent').value = '25';
                    document.getElementById('silicaFumePercent').value = '5';
                    document.getElementById('rcaPercent').value = '50';
                    document.getElementById('coarseSG').value = '2.55';
                    break;
            }

            updateFromGrade();
            updateWaterReduction();
            calculateMix(false);
        }

        function updateFromGrade() {
            const grade = document.getElementById('concreteGrade').value;
            const customGroup = document.getElementById('customStrengthGroup');
            
            if (grade === 'custom') {
                customGroup.style.display = 'block';
            } else {
                customGroup.style.display = 'none';
                document.getElementById('targetStrength').value = grade;
                calculateMix(false);
            }
        }

        function toggleWCMode() {
            const isManual = document.getElementById('manualWC').checked;
            const modeLabel = document.getElementById('wcModeLabel');
            const autoInfo = document.getElementById('autoWCInfo');
            const manualControl = document.getElementById('manualWCControl');
            
            if (isManual) {
                modeLabel.textContent = 'Manual';
                modeLabel.style.color = '#ff6b6b';
                autoInfo.style.display = 'none';
                manualControl.style.display = 'block';
            } else {
                modeLabel.textContent = 'Auto';
                modeLabel.style.color = '#667eea';
                autoInfo.style.display = 'block';
                manualControl.style.display = 'none';
            }
            calculateMix(false);
        }

        function toggleSCM(scmType) {
            // Handle special cases for acronyms
            let checkboxId;
            if (scmType === 'ggbs') {
                checkboxId = 'useGGBS';
            } else if (scmType === 'rha') {
                checkboxId = 'useRHA';
            } else {
                checkboxId = `use${scmType.charAt(0).toUpperCase() + scmType.slice(1)}`;
            }
            
            const checkbox = document.getElementById(checkboxId);
            const options = document.getElementById(`${scmType}Options`);
            
            if (options) {
                options.style.display = checkbox.checked ? 'block' : 'none';
                
                if (checkbox.checked) {
                    updateSliderValue(scmType);
                }
                calculateMix(false);
            }
        }

        function toggleFineAggReplacement(aggType) {
            const checkbox = document.getElementById(`use${aggType.charAt(0).toUpperCase() + aggType.slice(1)}`);
            const options = document.getElementById(`${aggType}Options`);
            options.style.display = checkbox.checked ? 'block' : 'none';
            
            if (checkbox.checked) {
                updateSliderValue(aggType);
            }
            calculateMix(false);
        }

        function toggleCoarseAggReplacement(aggType) {
            let checkboxId;
            if (aggType === 'rca') {
                checkboxId = 'useRCA';
            } else if (aggType === 'recycledBrick') {
                checkboxId = 'useRecycledBrick';
            } else if (aggType === 'lightweightAgg') {
                checkboxId = 'useLightweightAgg';
            }
            
            const checkbox = document.getElementById(checkboxId);
            const options = document.getElementById(`${aggType}Options`);
            options.style.display = checkbox.checked ? 'block' : 'none';
            
            if (checkbox.checked) {
                updateSliderValue(aggType);
                // Update coarse SG based on selection
                if (aggType === 'rca' && checkbox.checked) {
                    const rcaSG = parseFloat(document.getElementById('rcaSG').value);
                    const rcaPercent = parseFloat(document.getElementById('rcaPercent').value) / 100;
                    const currentSG = 2.70; // natural aggregate SG
                    document.getElementById('coarseSG').value = (rcaSG * rcaPercent + currentSG * (1 - rcaPercent)).toFixed(2);
                } else if (aggType === 'lightweightAgg' && checkbox.checked) {
                    const lightSG = parseFloat(document.getElementById('lightweightAggSG').value);
                    document.getElementById('coarseSG').value = lightSG.toFixed(2);
                } else if (aggType === 'recycledBrick' && checkbox.checked) {
                    const brickSG = parseFloat(document.getElementById('recycledBrickSG').value);
                    const brickPercent = parseFloat(document.getElementById('recycledBrickPercent').value) / 100;
                    const currentSG = 2.70;
                    document.getElementById('coarseSG').value = (brickSG * brickPercent + currentSG * (1 - brickPercent)).toFixed(2);
                }
            }
            calculateMix(false);
        }

        function updateLightweightAggSG() {
            const aggType = document.getElementById('lightweightAggType').value;
            const sgInput = document.getElementById('lightweightAggSG');
            
            switch(aggType) {
                case 'expanded-clay':
                    sgInput.value = '1.60';
                    break;
                case 'expanded-shale':
                    sgInput.value = '1.55';
                    break;
                case 'pumice':
                    sgInput.value = '1.20';
                    break;
                case 'perlite':
                    sgInput.value = '0.80';
                    break;
                case 'vermiculite':
                    sgInput.value = '0.65';
                    break;
            }
            
            // Update coarse SG if 100% replacement
            const percent = parseFloat(document.getElementById('lightweightAggPercent').value);
            if (percent === 100) {
                document.getElementById('coarseSG').value = sgInput.value;
            }
            calculateMix(false);
        }

        function updateSliderValue(type) {
            // Handle SCM and aggregate sliders with "Percent" suffix
            let slider = document.getElementById(`${type}Percent`);
            let valueDisplay = document.getElementById(`${type}Value`);
            
            // Handle foam density (special case - kg/m¬≥)
            if (type === 'foamDensity') {
                slider = document.getElementById('foamDensity');
                valueDisplay = document.getElementById('foamDensityValue');
                const categoryLabel = document.getElementById('foamDensityCategory');
                if (slider && valueDisplay) {
                    const density = parseFloat(slider.value);
                    valueDisplay.textContent = density + ' kg/m¬≥';
                    
                    // Update category based on STANDARD density classifications
                    if (categoryLabel) {
                        if (density < 600) {
                            categoryLabel.textContent = '‚úì Non-structural - Insulation, thermal barrier';
                        } else if (density < 900) {
                            categoryLabel.textContent = '‚úì Lightweight fill - Roof fill, void filling';
                        } else if (density < 1200) {
                            categoryLabel.textContent = '‚úì Masonry units - Blocks, partition walls';
                        } else if (density < 1600) {
                            categoryLabel.textContent = '‚úì Structural lightweight - Low-rise construction';
                        } else {
                            categoryLabel.textContent = '‚úì Load-bearing - Designed structures, slabs';
                        }
                    }
                }
                return;
            }
            
            // Handle foam expansion ratio
            if (type === 'foamExpansion') {
                slider = document.getElementById('foamExpansionRatio');
                valueDisplay = document.getElementById('foamExpansionValue');
                if (slider && valueDisplay) {
                    valueDisplay.textContent = slider.value + ':1';
                }
                return;
            }
            
            // Handle foam air content
            if (type === 'foamAir') {
                slider = document.getElementById('foamAirContent');
                valueDisplay = document.getElementById('foamAirValue');
                const benefitLabel = document.getElementById('foamAirBenefit');
                if (slider && valueDisplay) {
                    const airContent = parseFloat(slider.value);
                    valueDisplay.textContent = airContent + '%';
                    
                    if (benefitLabel) {
                        if (airContent < 50) {
                            benefitLabel.textContent = '‚úì Low void - Higher strength & density';
                        } else if (airContent < 70) {
                            benefitLabel.textContent = '‚úì Medium void - Balanced properties';
                        } else {
                            benefitLabel.textContent = '‚úì High void - Maximum insulation, lightweight';
                        }
                    }
                }
                return;
            }
            
            // Handle fiber dosage (special case - kg/m¬≥)
            if (type === 'fiber') {
                slider = document.getElementById('fiberDosage');
                valueDisplay = document.getElementById('fiberValue');
                if (slider && valueDisplay) {
                    valueDisplay.textContent = slider.value + ' kg/m¬≥';
                }
                return;
            }
            
            // Handle temperature (special case - ¬∞C)
            if (type === 'ambientTemp') {
                slider = document.getElementById('ambientTemp');
                valueDisplay = document.getElementById('ambientTempValue');
                if (slider && valueDisplay) {
                    const temp = parseFloat(slider.value);
                    valueDisplay.textContent = temp + '¬∞C';
                    valueDisplay.style.background = temp > 35 ? 'linear-gradient(135deg, #f44336, #d32f2f)' :
                                                    temp > 25 ? 'linear-gradient(135deg, #ff9800, #f57c00)' :
                                                    temp < 10 ? 'linear-gradient(135deg, #2196f3, #1565c0)' :
                                                    'linear-gradient(135deg, #4caf50, #388e3c)';
                }
                return;
            }
            
            // Handle admixture sliders with "Dosage" or direct ID
            if (!slider) {
                slider = document.getElementById(`${type}Dosage`) || document.getElementById(type);
            }
            
            if (slider && valueDisplay) {
                valueDisplay.textContent = slider.value + '%';
            }
        }

        function toggleAdmixture(admType) {
            const checkbox = document.getElementById(`use${admType.charAt(0).toUpperCase() + admType.slice(1)}`);
            const options = document.getElementById(`${admType}Options`);
            options.style.display = checkbox.checked ? 'block' : 'none';
            
            if (checkbox.checked) {
                updateSliderValue(admType);
            }
            calculateMix(false);
        }

        function updateFineAggProperties() {
            const fineAggType = document.getElementById('fineAggType').value;
            const fineSGInput = document.getElementById('fineSG');
            
            switch(fineAggType) {
                case 'natural':
                    fineSGInput.value = '2.65';
                    break;
                case 'msand':
                    fineSGInput.value = '2.74';
                    break;
                case 'mixed':
                    fineSGInput.value = '2.70';
                    break;
            }
        }

        function toggleSuperplasticizer() {
            const checked = document.getElementById('useSuperplasticizer').checked;
            document.getElementById('superplasticizerOptions').style.display = checked ? 'block' : 'none';
            if (checked) {
                updateWaterReduction();
            } else {
                calculateMix(false);
            }
        }

        function toggleAirEntraining() {
            const checked = document.getElementById('useAirEntraining').checked;
            document.getElementById('airEntrainingOptions').style.display = checked ? 'block' : 'none';
            calculateMix(false);
        }

        function updateWaterReduction() {
            const spType = document.getElementById('superplasticizerType').value;
            const dosage = parseFloat(document.getElementById('superplasticizerDosage').value);

            let waterReduction;
            switch(spType) {
                case 'PCE':
                    waterReduction = Math.min(18 + (dosage * 13), 40);
                    break;
                case 'SNF':
                    waterReduction = Math.min(12 + (dosage * 10), 30);
                    break;
                case 'SMF':
                    waterReduction = Math.min(12 + (dosage * 10), 28);
                    break;
                case 'ligno':
                    waterReduction = Math.min(8 + (dosage * 6), 18);
                    break;
                default:
                    waterReduction = 25;
            }

            waterReduction = Math.round(waterReduction);
            document.getElementById('waterReduction').value = waterReduction;
            document.getElementById('waterReductionBadge').textContent = waterReduction + '% reduction';
            calculateMix(false);
        }

        function determineConcreteType(params) {
            const { strength, wcRatio, slump, hasSilicaFume, hasVMA, totalSCM, placement, useSP, hasFoamAgent, density, hasFibers, fineAggPercent } = params;

            let type = 'normal';
            let className = 'normal';
            let description = '';
            let applications = '';
            let characteristics = '';

            // Foam Concrete - check first (Per ASTM C796, ACI 523.3R standards)
            if (hasFoamAgent && density < 1900) {
                let foamCategory, structuralClass, thermalCond, estStrength, mainApplications;
                
                // Standard density classifications per ACI 523.3R and IS 2185
                if (density < 600) {
                    foamCategory = 'Non-structural';
                    structuralClass = 'Insulation grade';
                    thermalCond = '0.10-0.18';
                    estStrength = (density * 0.0025).toFixed(1); // 0.25 MPa per 100 kg/m¬≥
                    mainApplications = 'Thermal insulation, acoustic barriers, roof insulation, under-floor heating';
                } else if (density < 900) {
                    foamCategory = 'Lightweight Fill';
                    structuralClass = 'Non-load bearing';
                    thermalCond = '0.18-0.30';
                    estStrength = (density * 0.003).toFixed(1); // 0.30 MPa per 100 kg/m¬≥
                    mainApplications = 'Void filling, trench reinstatement, roof fill, tunnel linings, sub-base';
                } else if (density < 1200) {
                    foamCategory = 'Masonry Grade';
                    structuralClass = 'Block production';
                    thermalCond = '0.30-0.45';
                    estStrength = (density * 0.0032).toFixed(1); // 0.32 MPa per 100 kg/m¬≥
                    mainApplications = 'Lightweight blocks, partition walls, cladding panels, fire-resistant walls';
                } else if (density < 1600) {
                    foamCategory = 'Structural Lightweight';
                    structuralClass = 'Low-rise structures';
                    thermalCond = '0.45-0.60';
                    estStrength = (density * 0.0035).toFixed(1); // 0.35 MPa per 100 kg/m¬≥
                    mainApplications = 'Composite slabs, lightweight panels, low-rise construction, precast elements';
                } else {
                    foamCategory = 'Load-bearing';
                    structuralClass = 'Structural grade';
                    thermalCond = '0.60-0.75';
                    estStrength = (density * 0.004).toFixed(1); // 0.40 MPa per 100 kg/m¬≥
                    mainApplications = 'Structural slabs, load-bearing walls, composite structures, engineered fills';
                }
                
                type = `Foam Concrete (${foamCategory} - ${density} kg/m¬≥)`;
                className = 'foam';
                description = `Cellular concrete per ASTM C796 & ACI 523.3R - ${structuralClass} with excellent thermal and acoustic properties`;
                applications = mainApplications;
                characteristics = `Density: ${density} kg/m¬≥ | Est. Strength: ${estStrength} MPa (28-day) | Thermal: ${thermalCond} W/mK | Air voids: 40-80% | Standards: ASTM C796, ACI 523.3R, BS 8110, IS 2185-4`;
            }
            // Geopolymer Concrete
            else if (totalSCM >= 70 && !hasSilicaFume) {
                type = 'Geopolymer Concrete';
                className = 'geopolymer';
                description = 'Zero-cement concrete, excellent chemical resistance, sustainable alternative';
                applications = 'Sustainable construction, acid-resistant structures, high-temperature applications, green building';
                characteristics = `Total SCM: ${totalSCM}%, Alkaline activated, Low CO‚ÇÇ emissions, Excellent acid resistance`;
            }
            // Fiber Reinforced Concrete
            else if (hasFibers) {
                type = 'Fiber Reinforced Concrete (FRC)';
                className = 'fiber';
                description = 'Enhanced crack control, impact resistance, and improved ductility';
                applications = 'Industrial floors, pavements, tunnel linings, shotcrete, earthquake-resistant structures';
                characteristics = `Compressive strength: ${strength} MPa, Improved toughness, Reduced crack width, Enhanced durability`;
            }
            // Pervious Concrete
            else if (fineAggPercent < 15 && slump < 100) {
                type = 'Pervious Concrete (Permeable)';
                className = 'pervious';
                description = 'High porosity for water drainage, stormwater management, eco-friendly';
                applications = 'Parking lots, sidewalks, driveways, stormwater management, permeable pavements';
                characteristics = `Void content: 15-30%, Infiltration rate: 2-6 mm/sec, Low fine aggregate content, Open-graded`;
            }
            else if (strength >= 60 && wcRatio <= 0.35 && hasSilicaFume && useSP) {
                type = 'Ultra-High Performance Concrete (UHPC)';
                className = 'uhpc';
                description = 'Ultra-high strength, very low permeability, exceptional durability';
                applications = 'Bridges, high-rise buildings, precast elements, protective structures';
                characteristics = `Compressive strength >60 MPa, W/C <0.35, Contains silica fume, High superplasticizer dosage`;
            }
            else if (slump >= 200 && hasVMA && useSP && placement === 'scc') {
                type = 'Self-Compacting Concrete (SCC)';
                className = 'scc';
                description = 'Flows under its own weight, no vibration needed, excellent finish';
                applications = 'Complex forms, congested reinforcement, architectural elements, precast';
                characteristics = `Slump flow >600mm, High powder content, VMA required, No vibration needed`;
            }
            else if (strength >= 40 && wcRatio <= 0.40 && useSP) {
                type = 'High-Performance Concrete (HPC)';
                className = 'hpc';
                description = 'High strength, enhanced durability, low permeability';
                applications = 'High-rise buildings, marine structures, parking structures, bridge decks';
                characteristics = `Compressive strength 40-60 MPa, W/C ‚â§0.40, Superplasticizer required`;
            }
            else if (totalSCM >= 50 && strength <= 35) {
                type = 'Mass Concrete';
                className = 'mass';
                description = 'Low heat generation, reduced thermal cracking, high SCM content';
                applications = 'Dams, foundations, raft slabs, large footings, retaining walls';
                characteristics = `High SCM content (‚â•50%), Low heat of hydration, Reduced early strength`;
            }
            else {
                type = 'Normal Concrete';
                className = 'normal';
                description = 'Standard structural concrete for general construction';
                applications = 'Residential buildings, commercial structures, pavements, general construction';
                characteristics = `Compressive strength 20-40 MPa, W/C 0.40-0.60, Standard mix proportions`;
            }

            return { type, className, description, applications, characteristics };
        }

        // ========== FOAM CONCRETE CALCULATION (ASTM C796, ACI 523.3R) ==========
        function calculateFoamConcreteMix(targetStrength, targetDensity, scmComposition, totalSCMPercent, cementSG, fineSG, coarseSG, stdDev, exposure) {
            console.log('ü´ß FOAM CONCRETE MODE ACTIVATED - Using ASTM C796 / ACI 523.3R method');
            
            // Get foam parameters
            const foamAgentDosage = parseFloat(document.getElementById('foamAgentDosage').value) / 100;
            const foamExpansionRatio = parseFloat(document.getElementById('foamExpansionRatio').value);
            const targetAirContent = parseFloat(document.getElementById('foamAirContent').value) / 100;
            const foamType = document.getElementById('foamType').value;
            
            // STEP 1: Calculate BASE MIX (cement + sand + water) - No coarse aggregate for foam concrete
            // Base mix W/C ratio for foam concrete is typically 0.40-0.55
            const wcRatio = 0.45; // Standard for foam concrete per ACI 523.3R
            
            // STEP 2: Calculate solid volume needed
            // Target density is achieved by replacing volume with air (foam)
            // Solid fraction = (1 - air content)
            const solidFraction = 1 - targetAirContent;
            
            // STEP 3: Base mix proportions (per m¬≥ of BASE MIX, not final foam concrete)
            // For foam concrete, typical cement content: 300-400 kg/m¬≥ of base mix
            let baseCementContent = 350; // kg/m¬≥ of base mix
            
            // Adjust cement for very low density foam
            if (targetDensity < 600) {
                baseCementContent = 300;
            } else if (targetDensity > 1400) {
                baseCementContent = 400;
            }
            
            // Water content from W/C ratio
            const baseWaterContent = baseCementContent * wcRatio;
            
            // Fine aggregate (sand) for foam concrete - typically 1.5-2.5 times cement weight
            // Lower densities use less sand
            let sandCementRatio;
            if (targetDensity < 800) {
                sandCementRatio = 0; // No sand for ultra-light foam
            } else if (targetDensity < 1200) {
                sandCementRatio = 1.0;
            } else {
                sandCementRatio = 1.8;
            }
            
            const baseSandContent = baseCementContent * sandCementRatio;
            
            // STEP 4: Calculate base mix density
            const cementVolume = baseCementContent / (cementSG * 1000);
            const waterVolume = baseWaterContent / 1000;
            const sandVolume = baseSandContent / (fineSG * 1000);
            
            const baseMixDensity = baseCementContent + baseWaterContent + baseSandContent;
            const baseMixVolume = cementVolume + waterVolume + sandVolume;
            
            // STEP 5: Calculate final quantities per m¬≥ of FOAM CONCRETE
            // Final quantities = Base mix √ó solid fraction
            const finalCement = Math.round(baseCementContent * solidFraction);
            const finalWater = Math.round(baseWaterContent * solidFraction);
            const finalSand = Math.round(baseSandContent * solidFraction);
            
            // Calculate SCM if used
            let finalOPC = finalCement;
            let scmWeight = 0;
            if (totalSCMPercent > 0) {
                scmWeight = finalCement * (totalSCMPercent / 100);
                finalOPC = finalCement - scmWeight;
            }
            
            // STEP 6: Calculate foam volume and foam agent required
            const solidVolume = solidFraction; // m¬≥ per m¬≥ of foam concrete
            const foamVolume = targetAirContent; // m¬≥ per m¬≥ of foam concrete
            
            // Foam agent required (liters)
            const foamAgentRequired = (foamVolume * 1000) / foamExpansionRatio;
            const foamAgentKg = foamAgentRequired * 1.02; // Density ~1.02 kg/L for foam agents
            
            // STEP 7: Calculate actual achieved density
            const calculatedDensity = finalCement + finalWater + finalSand + foamAgentKg;
            
            // STEP 8: Estimate compressive strength (Research-based formula)
            // Strength correlates with density: approximately 0.25-0.40 MPa per 100 kg/m¬≥
            let strengthFactor;
            if (targetDensity < 800) {
                strengthFactor = 0.0025; // 0.25 MPa per 100 kg/m¬≥
            } else if (targetDensity < 1200) {
                strengthFactor = 0.003; // 0.30 MPa per 100 kg/m¬≥
            } else if (targetDensity < 1600) {
                strengthFactor = 0.0035; // 0.35 MPa per 100 kg/m¬≥
            } else {
                strengthFactor = 0.004; // 0.40 MPa per 100 kg/m¬≥
            }
            
            const estimatedStrength = (targetDensity * strengthFactor).toFixed(1);
            
            // STEP 9: Calculate thermal conductivity (W/mK)
            // Formula: k = 0.00015 √ó density + 0.01
            const thermalConductivity = (0.00015 * targetDensity + 0.01).toFixed(3);
            
            // STEP 10: Determine concrete type info
            const concreteTypeInfo = determineConcreteType({
                strength: parseFloat(estimatedStrength),
                wcRatio: wcRatio,
                slump: 175,
                hasSilicaFume: false,
                hasVMA: false,
                totalSCM: totalSCMPercent,
                placement: 'normal',
                useSP: false,
                hasFoamAgent: true,
                density: targetDensity,
                hasFibers: false,
                fineAggPercent: 1.0
            });
            
            // Update UI with results
            const typeBadge = document.getElementById('concreteTypeBadge');
            typeBadge.textContent = concreteTypeInfo.type.toUpperCase();
            typeBadge.className = `concrete-type-badge ${concreteTypeInfo.className}`;
            
            const typeDetails = document.getElementById('concreteTypeDetails');
            const selectedPreset = document.getElementById('presetType').value;
            let presetInfo = '';
            if (selectedPreset === 'foam') {
                presetInfo = `<p style="background: #e8f5e9; padding: 8px; border-radius: 6px; margin-bottom: 10px;"><strong>Selected Preset:</strong> ü´ß Foam Concrete</p>`;
            }
            
            typeDetails.innerHTML = presetInfo + `
                <p><strong>Detected Type:</strong> ${concreteTypeInfo.type}</p>
                <p><strong>Description:</strong> ${concreteTypeInfo.description}</p>
                <p><strong>Applications:</strong> ${concreteTypeInfo.applications}</p>
                <p><strong>Characteristics:</strong> ${concreteTypeInfo.characteristics}</p>
            `;
            
            // Display mix quantities
            document.getElementById('cementResult').textContent = Math.round(finalOPC);
            document.getElementById('totalCementResult').textContent = finalCement;
            document.getElementById('waterResult').textContent = finalWater;
            document.getElementById('fineResult').textContent = finalSand;
            document.getElementById('coarseResult').textContent = 0; // No coarse aggregate in foam concrete
            document.getElementById('wcRatio').textContent = wcRatio.toFixed(2);
            document.getElementById('mixStrength').textContent = estimatedStrength;
            
            // Hide/show relevant cards
            document.getElementById('scmResultItem').style.display = totalSCMPercent > 0 ? 'block' : 'none';
            document.getElementById('scmResults').style.display = totalSCMPercent > 0 ? 'block' : 'none';
            
            if (totalSCMPercent > 0) {
                let scmHTML = `<p><strong>Total SCM Replacement: ${totalSCMPercent}%</strong> (${Math.round(scmWeight)} kg/m¬≥)</p>`;
                scmComposition.forEach(scm => {
                    const scmAmount = Math.round(finalCement * (scm.percent / 100));
                    scmHTML += `<p><strong>${scm.name}:</strong> ${scm.percent}% = ${scmAmount} kg/m¬≥<br>`;
                    scmHTML += `<em>${scm.benefits}</em></p>`;
                });
                document.getElementById('scmDetails').innerHTML = scmHTML;
            }
            
            // Display FOAM-SPECIFIC INFORMATION
            const admixtureResults = document.getElementById('admixtureResults');
            admixtureResults.style.display = 'block';
            
            let foamHTML = `
                <div style="background: linear-gradient(135deg, #fff3e0, #ffe0b2); padding: 15px; border-radius: 12px; border: 2px solid #ffa726; margin-bottom: 15px;">
                    <h3 style="color: #e65100; margin-bottom: 10px; font-size: 1.1rem;">ü´ß FOAM CONCRETE METHODOLOGY (ASTM C796, ACI 523.3R)</h3>
                    
                    <div style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 10px;">
                        <p style="margin: 5px 0; font-size: 0.9rem;"><strong>üìã Standards Used:</strong></p>
                        <p style="margin: 5px 0; font-size: 0.85rem;">
                            ‚Ä¢ ASTM C796 - Standard Test Method for Foaming Agents<br>
                            ‚Ä¢ ACI 523.3R - Guide for Cellular Concretes Above 800 kg/m¬≥<br>
                            ‚Ä¢ BS 8110 - Structural Use of Concrete<br>
                            ‚Ä¢ IS 2185 (Part 4) - Concrete Masonry Units
                        </p>
                    </div>
                    
                    <div style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 10px;">
                        <p style="margin: 5px 0;"><strong>üî¨ Calculation Method:</strong></p>
                        <p style="margin: 5px 0; font-size: 0.85rem; line-height: 1.6;">
                            1. Base Mix Design: Cement (${baseCementContent} kg/m¬≥) + Water (${Math.round(baseWaterContent)} kg/m¬≥) + Sand (${Math.round(baseSandContent)} kg/m¬≥)<br>
                            2. W/C Ratio: ${wcRatio} (Standard for foam concrete)<br>
                            3. Target Air Content: ${(targetAirContent * 100).toFixed(0)}% (Void volume)<br>
                            4. Solid Fraction: ${(solidFraction * 100).toFixed(0)}% (Material volume)<br>
                            5. Final quantities = Base mix √ó Solid fraction
                        </p>
                    </div>
                    
                    <div style="background: white; padding: 12px; border-radius: 8px;">
                        <p style="margin: 5px 0;"><strong>ü´ß Foam Agent Details:</strong></p>
                        <p style="margin: 5px 0; font-size: 0.85rem;">
                            ‚Ä¢ Type: ${foamType === 'protein' ? 'Protein-based (Natural)' : 'Synthetic (Chemical)'}<br>
                            ‚Ä¢ Dosage: ${(foamAgentDosage * 100).toFixed(1)}% of total mix<br>
                            ‚Ä¢ Expansion Ratio: ${foamExpansionRatio}:1<br>
                            ‚Ä¢ Foam Volume Required: ${(foamVolume * 1000).toFixed(0)} liters/m¬≥<br>
                            ‚Ä¢ Foam Agent Required: ${foamAgentRequired.toFixed(2)} liters/m¬≥ (${foamAgentKg.toFixed(2)} kg/m¬≥)
                        </p>
                    </div>
                </div>
                
                <div style="background: #e3f2fd; padding: 12px; border-radius: 10px; border-left: 4px solid #2196f3;">
                    <p style="margin: 5px 0;"><strong>üìä Performance Estimates:</strong></p>
                    <p style="margin: 5px 0; font-size: 0.85rem;">
                        ‚Ä¢ Target Density: ${targetDensity} kg/m¬≥<br>
                        ‚Ä¢ Calculated Density: ${calculatedDensity.toFixed(0)} kg/m¬≥<br>
                        ‚Ä¢ Est. 28-day Strength: ${estimatedStrength} MPa (${strengthFactor} MPa per 100 kg/m¬≥)<br>
                        ‚Ä¢ Thermal Conductivity: ${thermalConductivity} W/mK<br>
                        ‚Ä¢ Air Content: ${(targetAirContent * 100).toFixed(0)}%<br>
                        ‚Ä¢ Sand-to-Cement Ratio: ${sandCementRatio.toFixed(1)}:1
                    </p>
                </div>
            `;
            
            document.getElementById('admixtureDetails').innerHTML = foamHTML;
            
            // Calculate cost
            calculateCost(finalOPC, scmWeight, finalSand, 0, foamAgentKg);
            
            console.log('‚úÖ Foam concrete calculation complete');
            console.log(`Target: ${targetDensity} kg/m¬≥ | Calculated: ${calculatedDensity.toFixed(0)} kg/m¬≥`);
            console.log(`Est. Strength: ${estimatedStrength} MPa | Thermal: ${thermalConductivity} W/mK`);
        }
        // ========== END FOAM CONCRETE CALCULATION ==========

        function calculateMix(shouldScroll = false) {
            const grade = document.getElementById('concreteGrade').value;
            const targetStrength = grade === 'custom' ? 
                parseFloat(document.getElementById('targetStrength').value) :
                parseFloat(grade);
            
            const exposure = document.getElementById('exposure').value;
            const maxAggSize = parseFloat(document.getElementById('maxAggSize').value);
            const slump = parseFloat(document.getElementById('slump').value);
            const cementSG = parseFloat(document.getElementById('cementSG').value);
            const fineSG = parseFloat(document.getElementById('fineSG').value);
            const coarseSG = parseFloat(document.getElementById('coarseSG').value);
            const fineAggPercent = parseFloat(document.getElementById('fineAggPercent').value) / 100;
            const stdDev = parseFloat(document.getElementById('stdDev').value);
            const volume = parseFloat(document.getElementById('volume').value);
            const placement = document.getElementById('placement').value;

            const isManualWC = document.getElementById('manualWC').checked;

            const useFlyAsh = document.getElementById('useFlyAsh').checked;
            const useGGBS = document.getElementById('useGGBS').checked;
            const useSilicaFume = document.getElementById('useSilicaFume').checked;
            const useMetakaolin = document.getElementById('useMetakaolin').checked;
            const useRHA = document.getElementById('useRHA').checked;

            let totalSCMPercent = 0;
            let scmComposition = [];
            let waterDemandFactor = 1.0;
            let strengthEfficiencyFactor = 1.0;

            if (useFlyAsh) {
                const percent = parseFloat(document.getElementById('flyAshPercent').value);
                const type = document.getElementById('flyAshType').value;
                totalSCMPercent += percent;
                scmComposition.push({
                    name: type === 'classF' ? 'Fly Ash (Class F)' : 'Fly Ash (Class C)',
                    percent: percent,
                    sg: parseFloat(document.getElementById('flyAshSG').value),
                    benefits: type === 'classF' ? 
                        'Reduced heat of hydration, improved long-term strength, enhanced durability' :
                        'Better early strength, self-cementitious properties, reduced permeability'
                });
                waterDemandFactor -= percent / 100 * 0.08;
                strengthEfficiencyFactor = type === 'classF' ? 0.95 : 0.98;
            }

            if (useGGBS) {
                const percent = parseFloat(document.getElementById('ggbsPercent').value);
                totalSCMPercent += percent;
                scmComposition.push({
                    name: 'GGBS (Slag Cement)',
                    percent: percent,
                    sg: parseFloat(document.getElementById('ggbsSG').value),
                    benefits: 'Excellent sulfate resistance, very low heat, superior long-term strength, high density'
                });
                waterDemandFactor -= percent / 100 * 0.05;
                strengthEfficiencyFactor = Math.min(strengthEfficiencyFactor, 0.92);
            }

            if (useSilicaFume) {
                const percent = parseFloat(document.getElementById('silicaFumePercent').value);
                totalSCMPercent += percent;
                scmComposition.push({
                    name: 'Silica Fume',
                    percent: percent,
                    sg: parseFloat(document.getElementById('silicaFumeSG').value),
                    benefits: 'Ultra-high strength, very low permeability, excellent chloride resistance'
                });
                waterDemandFactor += percent / 100 * 0.15;
                strengthEfficiencyFactor = Math.max(strengthEfficiencyFactor, 1.15);
            }

            if (useMetakaolin) {
                const percent = parseFloat(document.getElementById('metakaolinPercent').value);
                totalSCMPercent += percent;
                scmComposition.push({
                    name: 'Metakaolin',
                    percent: percent,
                    sg: parseFloat(document.getElementById('metakaolinSG').value),
                    benefits: 'Enhanced durability, reduced efflorescence, improved aesthetics, good early strength'
                });
                waterDemandFactor += percent / 100 * 0.10;
                strengthEfficiencyFactor = Math.max(strengthEfficiencyFactor, 1.05);
            }

            if (useRHA) {
                const percent = parseFloat(document.getElementById('rhaPercent').value);
                totalSCMPercent += percent;
                scmComposition.push({
                    name: 'Rice Husk Ash',
                    percent: percent,
                    sg: parseFloat(document.getElementById('rhaSG').value),
                    benefits: 'Sustainable, high pozzolanic activity, improved strength, reduced permeability'
                });
                waterDemandFactor += percent / 100 * 0.08;
                strengthEfficiencyFactor = Math.max(strengthEfficiencyFactor, 1.02);
            }

            if (totalSCMPercent > 75) {
                alert('Total SCM replacement cannot exceed 75%. Please adjust your selections.');
                return;
            }

            const useSuperplasticizer = document.getElementById('useSuperplasticizer').checked;
            const waterReduction = useSuperplasticizer ? parseFloat(document.getElementById('waterReduction').value) : 0;
            const useAirEntraining = document.getElementById('useAirEntraining').checked;
            const airContent = useAirEntraining ? parseFloat(document.getElementById('airContent').value) / 100 : 0.02;
            const useVMA = document.getElementById('useViscosity').checked;
            const useFoamAgent = document.getElementById('useFoamAgent').checked;
            const foamDensity = useFoamAgent ? parseFloat(document.getElementById('foamDensity').value) : 2400;

            // ========== FOAM CONCRETE CALCULATION METHOD (Per ASTM C796, ACI 523.3R) ==========
            if (useFoamAgent && foamDensity < 1900) {
                calculateFoamConcreteMix(targetStrength, foamDensity, scmComposition, totalSCMPercent, cementSG, fineSG, coarseSG, stdDev, exposure);
                return; // Exit regular calculation - foam uses different method
            }
            // ========== END FOAM CONCRETE METHOD ==========

            const mixStrength = (targetStrength + 1.65 * stdDev) / strengthEfficiencyFactor;

            let wcRatio;
            if (isManualWC) {
                wcRatio = parseFloat(document.getElementById('manualWCValue').value);
            } else {
                let maxWC;
                switch(exposure) {
                    case 'mild': maxWC = 0.55; break;
                    case 'moderate': maxWC = 0.50; break;
                    case 'severe': maxWC = 0.45; break;
                    case 'very-severe': maxWC = 0.40; break;
                    case 'marine': maxWC = 0.38; break;
                    default: maxWC = 0.50;
                }

                let calculatedWC = 0.5 / (1 + (mixStrength - 20) / 80);
                wcRatio = Math.max(calculatedWC, maxWC);
            }

            let baseWaterContent;
            if (maxAggSize === 10) {
                baseWaterContent = slump < 50 ? 185 : slump < 100 ? 205 : slump < 150 ? 225 : slump < 200 ? 240 : 260;
            } else if (maxAggSize === 20) {
                baseWaterContent = slump < 50 ? 170 : slump < 100 ? 190 : slump < 150 ? 210 : slump < 200 ? 225 : 245;
            } else {
                baseWaterContent = slump < 50 ? 160 : slump < 100 ? 175 : slump < 150 ? 195 : slump < 200 ? 210 : 230;
            }

            baseWaterContent = baseWaterContent * waterDemandFactor;
            const waterContent = Math.round(baseWaterContent * (1 - waterReduction / 100));

            const totalCementitious = Math.round(waterContent / wcRatio);
            const finalTotalCementitious = Math.max(totalCementitious, 320);

            const scmWeight = finalTotalCementitious * (totalSCMPercent / 100);
            const opcWeight = finalTotalCementitious - scmWeight;

            const actualWC = Math.round((waterContent / finalTotalCementitious) * 100) / 100;

            let cementVolume = opcWeight / (cementSG * 1000);
            
            scmComposition.forEach(scm => {
                const scmAmount = finalTotalCementitious * (scm.percent / 100);
                cementVolume += scmAmount / (scm.sg * 1000);
            });

            const waterVolume = waterContent / 1000;
            const entrappedAir = airContent;

            const aggregateVolume = 1 - cementVolume - waterVolume - entrappedAir;

            const fineAggVolume = aggregateVolume * fineAggPercent;
            const coarseAggVolume = aggregateVolume * (1 - fineAggPercent);

            const fineAggWeight = Math.round(fineAggVolume * fineSG * 1000);
            const coarseAggWeight = Math.round(coarseAggVolume * coarseSG * 1000);

            const useFibers = document.getElementById('useFibers').checked;

            const concreteTypeInfo = determineConcreteType({
                strength: targetStrength,
                wcRatio: actualWC,
                slump: slump,
                hasSilicaFume: useSilicaFume,
                hasVMA: useVMA,
                totalSCM: totalSCMPercent,
                placement: placement,
                useSP: useSuperplasticizer,
                hasFoamAgent: useFoamAgent,
                density: foamDensity,
                hasFibers: useFibers,
                fineAggPercent: fineAggPercent * 100
            });

            const typeBadge = document.getElementById('concreteTypeBadge');
            typeBadge.textContent = concreteTypeInfo.type.toUpperCase();
            typeBadge.className = `concrete-type-badge ${concreteTypeInfo.className}`;
            
            console.log('üéØ Detected Concrete Type:', concreteTypeInfo.type);
            console.log('SCMs used:', { useFlyAsh, useGGBS, useSilicaFume, totalSCM: totalSCMPercent });
            console.log('Strength:', targetStrength, 'MPa | W/C:', actualWC);

            const typeDetails = document.getElementById('concreteTypeDetails');
            const selectedPreset = document.getElementById('presetType').value;
            let presetInfo = '';
            if (selectedPreset && selectedPreset !== '') {
                const presetNames = {
                    'normal': 'üè¢ Normal Concrete',
                    'hpc': '‚ö° High-Performance (HPC)',
                    'uhpc': 'üíé Ultra-High Performance (UHPC)',
                    'scc': 'üåä Self-Compacting (SCC)',
                    'mass': 'üèîÔ∏è Mass Concrete',
                    'marine': 'üåä Marine Concrete',
                    'foam': 'ü´ß Foam Concrete',
                    'fiber': 'üßµ Fiber Reinforced',
                    'geopolymer': '‚ôªÔ∏è Geopolymer',
                    'pervious': 'üíß Pervious Concrete',
                    'lightweight': 'ü™∂ Lightweight',
                    'recycled': '‚ôªÔ∏è Recycled Aggregate'
                };
                presetInfo = `<p style="background: #e8f5e9; padding: 8px; border-radius: 6px; margin-bottom: 10px;"><strong>Selected Preset:</strong> ${presetNames[selectedPreset] || selectedPreset}</p>`;
            }
            
            typeDetails.innerHTML = presetInfo + `
                <p><strong>Detected Type:</strong> ${concreteTypeInfo.type}</p>
                <p><strong>Description:</strong> ${concreteTypeInfo.description}</p>
                <p><strong>Applications:</strong> ${concreteTypeInfo.applications}</p>
                <p><strong>Characteristics:</strong> ${concreteTypeInfo.characteristics}</p>
            `;

            const cementProp = 1;
            const fineProp = Math.round((fineAggWeight / finalTotalCementitious) * 10) / 10;
            const coarseProp = Math.round((coarseAggWeight / finalTotalCementitious) * 10) / 10;

            document.getElementById('cementResult').textContent = Math.round(opcWeight);
            document.getElementById('totalCementResult').textContent = finalTotalCementitious;
            document.getElementById('waterResult').textContent = waterContent;
            document.getElementById('fineResult').textContent = fineAggWeight;
            document.getElementById('coarseResult').textContent = coarseAggWeight;
            document.getElementById('wcRatio').textContent = actualWC;
            document.getElementById('mixStrength').textContent = Math.round(targetStrength + 1.65 * stdDev);

            if (scmComposition.length > 0) {
                document.getElementById('scmResultItem').style.display = 'block';
                document.getElementById('scmResultLabel').textContent = 'Total SCM';
                document.getElementById('scmResult').textContent = Math.round(scmWeight);
                
                document.getElementById('scmResults').style.display = 'block';
                let scmHTML = `<p><strong>Total SCM Replacement: ${totalSCMPercent}%</strong> (${Math.round(scmWeight)} kg/m¬≥)</p>`;
                
                scmComposition.forEach(scm => {
                    const scmAmount = Math.round(finalTotalCementitious * (scm.percent / 100));
                    scmHTML += `<p><strong>${scm.name}:</strong> ${scm.percent}% = ${scmAmount} kg/m¬≥<br>`;
                    scmHTML += `<em>${scm.benefits}</em></p>`;
                });
                
                document.getElementById('scmDetails').innerHTML = scmHTML;
            } else {
                document.getElementById('scmResultItem').style.display = 'none';
                document.getElementById('scmResults').style.display = 'none';
            }

            const fineAggType = document.getElementById('fineAggType').value;
            const useQuarryDust = document.getElementById('useQuarryDust').checked;
            const useStoneDust = document.getElementById('useStoneDust').checked;

            if (fineAggType !== 'natural' || useQuarryDust || useStoneDust) {
                document.getElementById('fineAggResults').style.display = 'block';
                let fineAggHTML = '<p><strong>Fine Aggregate Composition:</strong></p>';
                
                let remaining = 100;
                if (useQuarryDust) {
                    const percent = parseFloat(document.getElementById('quarryDustPercent').value);
                    const amount = Math.round(fineAggWeight * percent / 100);
                    fineAggHTML += `<p>‚Ä¢ Quarry Dust: ${percent}% = ${amount} kg/m¬≥</p>`;
                    remaining -= percent;
                }
                if (useStoneDust) {
                    const percent = parseFloat(document.getElementById('stoneDustPercent').value);
                    const amount = Math.round(fineAggWeight * percent / 100);
                    fineAggHTML += `<p>‚Ä¢ Stone Dust: ${percent}% = ${amount} kg/m¬≥</p>`;
                    remaining -= percent;
                }
                
                const primaryAmount = Math.round(fineAggWeight * remaining / 100);
                const primaryType = fineAggType === 'natural' ? 'Natural Sand' : 
                                   fineAggType === 'msand' ? 'Manufactured Sand (M-Sand)' :
                                   'Mixed Sand (Natural + M-Sand)';
                fineAggHTML += `<p>‚Ä¢ ${primaryType}: ${remaining}% = ${primaryAmount} kg/m¬≥</p>`;
                
                document.getElementById('fineAggDetails').innerHTML = fineAggHTML;
            } else {
                document.getElementById('fineAggResults').style.display = 'none';
            }

            // Display coarse aggregate composition
            const useRCA = document.getElementById('useRCA').checked;
            const useRecycledBrick = document.getElementById('useRecycledBrick').checked;
            const useLightweightAgg = document.getElementById('useLightweightAgg').checked;

            if (useRCA || useRecycledBrick || useLightweightAgg) {
                document.getElementById('coarseAggResults').style.display = 'block';
                let coarseAggHTML = '<p><strong>Coarse Aggregate Composition:</strong></p>';
                
                let coarseRemaining = 100;
                if (useRCA) {
                    const percent = parseFloat(document.getElementById('rcaPercent').value);
                    const amount = Math.round(coarseAggWeight * percent / 100);
                    coarseAggHTML += `<p>‚Ä¢ Recycled Concrete Aggregate (RCA): ${percent}% = ${amount} kg/m¬≥ (SG: ${document.getElementById('rcaSG').value})</p>`;
                    coarseRemaining -= percent;
                }
                if (useRecycledBrick) {
                    const percent = parseFloat(document.getElementById('recycledBrickPercent').value);
                    const amount = Math.round(coarseAggWeight * percent / 100);
                    coarseAggHTML += `<p>‚Ä¢ Recycled Brick Aggregate: ${percent}% = ${amount} kg/m¬≥ (SG: ${document.getElementById('recycledBrickSG').value})</p>`;
                    coarseRemaining -= percent;
                }
                if (useLightweightAgg) {
                    const percent = parseFloat(document.getElementById('lightweightAggPercent').value);
                    const amount = Math.round(coarseAggWeight * percent / 100);
                    const lightType = document.getElementById('lightweightAggType').value;
                    const lightTypeName = lightType === 'expanded-clay' ? 'Expanded Clay (LECA)' :
                                         lightType === 'expanded-shale' ? 'Expanded Shale' :
                                         lightType === 'pumice' ? 'Pumice' :
                                         lightType === 'perlite' ? 'Perlite' : 'Vermiculite';
                    coarseAggHTML += `<p>‚Ä¢ Lightweight Aggregate (${lightTypeName}): ${percent}% = ${amount} kg/m¬≥ (SG: ${document.getElementById('lightweightAggSG').value})</p>`;
                    coarseRemaining -= percent;
                }
                
                if (coarseRemaining > 0) {
                    const naturalAmount = Math.round(coarseAggWeight * coarseRemaining / 100);
                    coarseAggHTML += `<p>‚Ä¢ Natural Coarse Aggregate: ${coarseRemaining}% = ${naturalAmount} kg/m¬≥ (SG: 2.70)</p>`;
                }
                
                coarseAggHTML += `<p><em>‚úì Combined Coarse Aggregate SG: ${document.getElementById('coarseSG').value}</em></p>`;
                
                document.getElementById('coarseAggDetails').innerHTML = coarseAggHTML;
            } else {
                document.getElementById('coarseAggResults').style.display = 'none';
            }

            let admixtureList = [];
            if (useSuperplasticizer) {
                const spType = document.getElementById('superplasticizerType').value;
                const dosage = document.getElementById('superplasticizerDosage').value;
                const spDosage = Math.round(finalTotalCementitious * volume * dosage / 100 * 100) / 100;
                
                let spName = spType === 'PCE' ? 'PCE-based Superplasticizer' : 
                            spType === 'SNF' ? 'SNF-based Superplasticizer' : 
                            spType === 'SMF' ? 'SMF-based Superplasticizer' :
                            'Lignosulfonate-based Plasticizer';
                
                admixtureList.push(`<p><strong>${spName}:</strong> ${dosage}% by cementitious weight = ${spDosage} kg (for ${volume} m¬≥)<br>
                                   <em>Effect: ${waterReduction}% water reduction, improved workability, reduced W/C ratio</em></p>`);
            }
            
            if (useAirEntraining) {
                const airPercent = parseFloat(document.getElementById('airContent').value);
                admixtureList.push(`<p><strong>Air-Entraining Agent:</strong> Target air content ${airPercent.toFixed(1)}%<br>
                                   <em>Effect: Improved freeze-thaw resistance, enhanced workability, increased durability</em></p>`);
            }
            
            if (document.getElementById('useRetarder').checked) {
                const retarderDosage = parseFloat(document.getElementById('retarderDosage').value);
                const retarderAmount = Math.round(finalTotalCementitious * volume * retarderDosage / 100 * 100) / 100;
                admixtureList.push(`<p><strong>Retarder:</strong> ${retarderDosage}% by cementitious weight = ${retarderAmount} kg (for ${volume} m¬≥)<br>
                                   <em>Effect: Delayed setting time 2-4 hours, reduced heat of hydration (useful in hot weather)</em></p>`);
            }
            
            if (document.getElementById('useAccelerator').checked) {
                const acceleratorDosage = parseFloat(document.getElementById('acceleratorDosage').value);
                const acceleratorAmount = Math.round(finalTotalCementitious * volume * acceleratorDosage / 100 * 100) / 100;
                admixtureList.push(`<p><strong>Accelerator:</strong> ${acceleratorDosage}% by cementitious weight = ${acceleratorAmount} kg (for ${volume} m¬≥)<br>
                                   <em>Effect: Faster setting and early strength gain (useful in cold weather)</em></p>`);
            }
            
            if (document.getElementById('useWaterproofing').checked) {
                const waterproofingDosage = parseFloat(document.getElementById('waterproofingDosage').value);
                const waterproofingAmount = Math.round(finalTotalCementitious * volume * waterproofingDosage / 100 * 100) / 100;
                admixtureList.push(`<p><strong>Waterproofing Agent:</strong> ${waterproofingDosage}% by cementitious weight = ${waterproofingAmount} kg (for ${volume} m¬≥)<br>
                                   <em>Effect: Reduced permeability, enhanced durability, water resistance</em></p>`);
            }

            if (useVMA) {
                const vmaDosage = parseFloat(document.getElementById('viscosityDosage').value);
                const vmaAmount = Math.round(finalTotalCementitious * volume * vmaDosage / 100 * 1000) / 1000;
                admixtureList.push(`<p><strong>Viscosity Modifying Agent (VMA):</strong> ${vmaDosage}% by cementitious weight = ${vmaAmount} kg (for ${volume} m¬≥)<br>
                                   <em>Effect: Improved cohesion, reduced segregation, better for SCC</em></p>`);
            }

            if (useFoamAgent) {
                const foamAgentDosage = parseFloat(document.getElementById('foamAgentDosage').value);
                const targetDensity = parseFloat(document.getElementById('foamDensity').value);
                const foamType = document.getElementById('foamType').value;
                const foamAgentAmount = Math.round(finalTotalCementitious * volume * foamAgentDosage / 100 * 100) / 100;
                const foamTypeName = foamType === 'protein' ? 'Protein-based' : 'Synthetic';
                admixtureList.push(`<p><strong>Foaming Agent (${foamTypeName}):</strong> ${foamAgentDosage}% by cementitious weight = ${foamAgentAmount} kg (for ${volume} m¬≥)<br>
                                   <em>Target Density: ${targetDensity} kg/m¬≥ | Air content: ~${Math.round((1 - targetDensity/2400) * 100)}% | Thermal conductivity: ${(0.1 + targetDensity/3000).toFixed(2)} W/mK</em></p>`);
            }

            if (useFibers) {
                const fiberType = document.getElementById('fiberType').value;
                const fiberDosage = parseFloat(document.getElementById('fiberDosage').value);
                const totalFibers = Math.round(fiberDosage * volume * 10) / 10;
                const fiberTypeName = fiberType === 'steel' ? 'Steel Fibers' :
                                     fiberType === 'polypropylene' ? 'Polypropylene Fibers' :
                                     fiberType === 'glass' ? 'Glass Fibers (GFRC)' :
                                     fiberType === 'carbon' ? 'Carbon Fibers' :
                                     'Basalt Fibers';
                admixtureList.push(`<p><strong>${fiberTypeName}:</strong> ${fiberDosage} kg/m¬≥ = ${totalFibers} kg (for ${volume} m¬≥)<br>
                                   <em>Effect: Enhanced crack control, improved toughness, impact resistance, reduced shrinkage cracking</em></p>`);
            }

            if (admixtureList.length > 0) {
                document.getElementById('admixtureResults').style.display = 'block';
                document.getElementById('admixtureDetails').innerHTML = admixtureList.join('');
            } else {
                document.getElementById('admixtureResults').style.display = 'none';
            }

            let proportionBreakdown = `Cement (OPC): ${cementProp}`;
            if (scmComposition.length > 0) {
                proportionBreakdown += ` + SCM: ${Math.round((scmWeight/opcWeight) * 10) / 10}`;
            }
            proportionBreakdown += ` : Fine Agg: ${fineProp} : Coarse Agg: ${coarseProp}`;
            
            document.getElementById('proportions').textContent = `${cementProp} : ${fineProp} : ${coarseProp}`;
            document.getElementById('proportionBreakdown').textContent = proportionBreakdown;

            document.getElementById('volumeDisplay').textContent = volume;
            let quantitiesText = `<strong>OPC Cement:</strong> ${Math.round(opcWeight * volume)} kg`;
            
            if (scmComposition.length > 0) {
                quantitiesText += ` | <strong>SCM:</strong> ${Math.round(scmWeight * volume)} kg`;
            }
            
            quantitiesText += ` | <strong>Total Cementitious:</strong> ${Math.round(finalTotalCementitious * volume)} kg<br>`;
            quantitiesText += `<strong>Water:</strong> ${Math.round(waterContent * volume)} liters | `;
            quantitiesText += `<strong>Fine Aggregate:</strong> ${Math.round(fineAggWeight * volume)} kg | `;
            quantitiesText += `<strong>Coarse Aggregate:</strong> ${Math.round(coarseAggWeight * volume)} kg`;
            
            document.getElementById('totalQuantities').innerHTML = quantitiesText;

            if (scmComposition.length > 0) {
                document.getElementById('sustainabilityInfo').style.display = 'block';
                const co2Reduction = Math.round(scmWeight * volume * 0.85);
                const sustainText = `By using ${totalSCMPercent}% SCM replacement (${Math.round(scmWeight * volume)} kg), you save approximately ` +
                                   `<strong>${co2Reduction} kg of CO‚ÇÇ</strong> emissions for ${volume} m¬≥ of concrete. ` +
                                   `This promotes sustainable construction and reduces environmental impact while maintaining or improving concrete performance.`;
                document.getElementById('sustainabilityDetails').innerHTML = sustainText;
            } else {
                document.getElementById('sustainabilityInfo').style.display = 'none';
            }

            // ===== COST CALCULATOR =====
            const totalAdmixtureWeight = (useSuperplasticizer ? finalTotalCementitious * 0.015 : 0) + 
                                        (useFibers ? parseFloat(document.getElementById('fiberDosage')?.value || 0) : 0);
            const costData = calculateCost(opcWeight, scmWeight, fineAggWeight, coarseAggWeight, totalAdmixtureWeight, volume);
            document.getElementById('costVolume').textContent = volume;
            document.getElementById('costBreakdown').innerHTML = `
                <strong>OPC Cement:</strong> ${costData.currency} ${costData.opcTotal} | 
                <strong>SCM:</strong> ${costData.currency} ${costData.scmTotal} | 
                <strong>Fine Agg:</strong> ${costData.currency} ${costData.fineTotal} | 
                <strong>Coarse Agg:</strong> ${costData.currency} ${costData.coarseTotal} | 
                <strong>Admixtures:</strong> ${costData.currency} ${costData.admixTotal}<br>
                <strong style="font-size: 1.1rem;">TOTAL: ${costData.currency} ${costData.grandTotal}</strong> 
                (${costData.currency} ${costData.perCubicMeter} per m¬≥)`;

            // ===== SUSTAINABILITY SCORE =====
            const sustainScore = calculateSustainabilityScore(totalSCMPercent, fineAggType === 'msand' || fineAggType === 'mixed', false, waterReduction);
            document.getElementById('sustainabilityScore').innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 3rem; font-weight: bold; color: ${sustainScore.color};">${sustainScore.score}/100</div>
                    <div style="font-size: 1.3rem; margin-top: 10px; color: ${sustainScore.color};">${sustainScore.rating}</div>
                    <div style="margin-top: 15px; text-align: left; color: #2e7d32;">
                        <strong>Score Breakdown:</strong><br>
                        ‚Ä¢ SCM Usage: +${Math.min(Math.round(totalSCMPercent * 0.4), 30)} points<br>
                        ‚Ä¢ Water Reduction: +${Math.min(Math.round(waterReduction * 0.5), 15)} points<br>
                        ‚Ä¢ Sustainable Aggregates: +${fineAggType !== 'natural' ? 5 : 0} points
                    </div>
                </div>`;

            // ===== STRENGTH PREDICTION =====
            const strengthPred = getStrengthPrediction(targetStrength, useFlyAsh, useGGBS, useSilicaFume);
            document.getElementById('strengthPrediction').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; text-align: center;">
                    <div style="background: #f5f5f5; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 0.9rem; color: #666;">3 Days</div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #667eea;">${strengthPred.day3}</div>
                        <div style="font-size: 0.8rem; color: #888;">MPa</div>
                    </div>
                    <div style="background: #f5f5f5; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 0.9rem; color: #666;">7 Days</div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #667eea;">${strengthPred.day7}</div>
                        <div style="font-size: 0.8rem; color: #888;">MPa</div>
                    </div>
                    <div style="background: #e8f5e9; padding: 15px; border-radius: 10px; border: 2px solid #4caf50;">
                        <div style="font-size: 0.9rem; color: #2e7d32;">28 Days</div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #2e7d32;">${strengthPred.day28}</div>
                        <div style="font-size: 0.8rem; color: #2e7d32;">MPa (Target)</div>
                    </div>
                    <div style="background: #f5f5f5; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 0.9rem; color: #666;">56 Days</div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #667eea;">${strengthPred.day56}</div>
                        <div style="font-size: 0.8rem; color: #888;">MPa</div>
                    </div>
                    <div style="background: #f5f5f5; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 0.9rem; color: #666;">90 Days</div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #667eea;">${strengthPred.day90}</div>
                        <div style="font-size: 0.8rem; color: #888;">MPa</div>
                    </div>
                </div>
                <p style="margin-top: 15px; color: #6a1b9a; font-size: 0.9rem;">
                    <strong>Note:</strong> Strength development varies with curing conditions, temperature, and material quality.
                </p>`;

            // ===== CURING SCHEDULE =====
            const curingInfo = getCuringSchedule(concreteTypeInfo.type, useGGBS, useFlyAsh);
            document.getElementById('curingSchedule').innerHTML = `
                <p style="color: #1565c0;"><strong>Minimum Duration:</strong> ${curingInfo.minimum}</p>
                <p style="color: #1565c0;"><strong>Recommended Duration:</strong> ${curingInfo.recommended}</p>
                <p style="color: #1565c0;"><strong>Curing Method:</strong> ${curingInfo.method}</p>
                <p style="color: #1565c0;"><strong>Important Notes:</strong> ${curingInfo.notes}</p>`;

            // ===== BATCH CALCULATOR =====
            const mixerCapacity = parseFloat(document.getElementById('mixerCapacity').value);
            const batchInfo = calculateBatches(volume, mixerCapacity);
            document.getElementById('batchCalculator').innerHTML = `
                <p style="color: #1b5e20;"><strong>Total Volume:</strong> ${volume} m¬≥</p>
                <p style="color: #1b5e20;"><strong>Mixer Capacity:</strong> ${mixerCapacity} m¬≥</p>
                <p style="color: #1b5e20;"><strong>Number of Batches:</strong> ${batchInfo.numBatches}</p>
                <p style="color: #1b5e20;"><strong>Last Batch Size:</strong> ${batchInfo.lastBatchSize} m¬≥</p>
                <p style="color: #1b5e20;"><strong>Mixing Time per Batch:</strong> ${batchInfo.mixingTime} minutes</p>
                <p style="color: #1b5e20;"><strong>Estimated Total Time:</strong> ${batchInfo.totalTime} minutes (${Math.round(batchInfo.totalTime/60)} hours)</p>`;

            // ===== TESTING SCHEDULE =====
            const testInfo = generateTestingSchedule(volume, concreteTypeInfo.type);
            document.getElementById('testingSchedule').innerHTML = `
                <p style="color: #01579b;"><strong>Testing Standard:</strong> ${testInfo.standards}</p>
                <p style="color: #01579b;"><strong>Test Ages:</strong> ${testInfo.testAges.join(', ')} days</p>
                <p style="color: #01579b;"><strong>Tests Required:</strong> ${testInfo.testsRequired} (every ${volume <= 25 ? volume : 25}m¬≥)</p>
                <p style="color: #01579b;"><strong>Cubes per Test:</strong> ${testInfo.cubesPerTest}</p>
                <p style="color: #01579b;"><strong>Total Cubes Needed:</strong> ${testInfo.totalCubes} cubes (150mm x 150mm x 150mm)</p>
                <p style="color: #01579b;"><strong>Slump Test:</strong> Every batch or every 50m¬≥</p>`;

            // ===== DURABILITY ASSESSMENT =====
            const durability = assessDurability(actualWC, totalSCMPercent, useSilicaFume, useGGBS, exposure);
            const getColorForRating = (rating) => {
                return rating === 'Excellent' ? '#2e7d32' : rating === 'Very Good' ? '#388e3c' : 
                       rating === 'Good' ? '#fbc02d' : rating === 'Moderate' ? '#f57c00' : '#d32f2f';
            };
            document.getElementById('durabilityParams').innerHTML = `
                <p style="color: #880e4f;"><strong>Overall Rating:</strong> <span style="color: ${getColorForRating(durability.overallRating)}; font-weight: bold;">${durability.overallRating}</span></p>
                <p style="color: #880e4f;"><strong>Chloride Resistance:</strong> <span style="color: ${getColorForRating(durability.chlorideResistance)};">${durability.chlorideResistance}</span></p>
                <p style="color: #880e4f;"><strong>Sulfate Resistance:</strong> <span style="color: ${getColorForRating(durability.sulfateResistance)};">${durability.sulfateResistance}</span></p>
                <p style="color: #880e4f;"><strong>Carbonation Resistance:</strong> <span style="color: ${getColorForRating(durability.carbonationResistance)};">${durability.carbonationResistance}</span></p>
                <p style="color: #880e4f;"><strong>Freeze-Thaw Resistance:</strong> <span style="color: ${getColorForRating(durability.freezeThawResistance)};">${durability.freezeThawResistance}</span></p>
                <p style="color: #880e4f;"><strong>Permeability:</strong> <span style="color: ${getColorForRating(durability.permeability === 'Very Low' ? 'Excellent' : durability.permeability === 'Low' ? 'Very Good' : 'Moderate')};">${durability.permeability}</span></p>`;

            // ===== WEATHER RECOMMENDATIONS =====
            const temp = parseFloat(document.getElementById('ambientTemp').value);
            const weatherCond = document.getElementById('weatherCondition').value;
            const weatherRecs = getWeatherRecommendations(temp, weatherCond);
            if (weatherRecs.length > 0) {
                document.getElementById('weatherRecommendations').style.display = 'block';
                document.getElementById('weatherAdvice').innerHTML = '<p style="color: #c62828;">' + weatherRecs.join('<br>') + '</p>';
            } else {
                document.getElementById('weatherRecommendations').style.display = 'none';
            }

            // ===== VISUAL CHARTS =====
            document.getElementById('visualCharts').innerHTML = generateVisualCharts(strengthPred, costData);

            // ===== AESTHETIC/COLOR ADDITIONS =====
            if (document.getElementById('usePigment')?.checked) {
                const pigmentColor = document.getElementById('pigmentColor').value;
                const pigmentDosage = parseFloat(document.getElementById('pigmentDosage').value);
                const pigmentAmount = Math.round(finalTotalCementitious * volume * pigmentDosage / 100 * 100) / 100;
                const aestheticInfo = `<p><strong>Color Pigment (${pigmentColor}):</strong> ${pigmentDosage}% by cement weight = ${pigmentAmount} kg<br>
                                      <em>For best color: Use white cement, ensure consistent mixing, cure properly to avoid efflorescence</em></p>`;
                if (admixtureList.length > 0) {
                    document.getElementById('admixtureDetails').innerHTML += aestheticInfo;
                }
            }

            document.getElementById('resultsCard').style.display = 'block';
            
            // Only scroll to results if explicitly requested (button click)
            if (shouldScroll) {
                setTimeout(() => {
                    document.getElementById('resultsCard').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            }
        }

        // ========== ADVANCED FEATURES ==========


        // Mix Optimization
        function optimizeMix() {
            const options = ['cost', 'sustainability', 'strength'];
            const choice = prompt("Optimize for:\n1. Cost (minimum cost)\n2. Sustainability (maximum green score)\n3. Strength (maximum performance)\n\nEnter 1, 2, or 3:");
            
            if (choice === '1') {
                document.getElementById('useFlyAsh').checked = true;
                document.getElementById('flyAshPercent').value = '35';
                document.getElementById('fineAggType').value = 'natural';
                toggleSCM('flyAsh');
                alert('‚úÖ Optimized for COST:\n‚Ä¢ 35% Fly Ash (cheaper than cement)\n‚Ä¢ Natural sand\n‚Ä¢ Minimal admixtures');
            } else if (choice === '2') {
                document.getElementById('useGGBS').checked = true;
                document.getElementById('useFlyAsh').checked = true;
                document.getElementById('ggbsPercent').value = '50';
                document.getElementById('flyAshPercent').value = '20';
                document.getElementById('fineAggType').value = 'msand';
                toggleSCM('ggbs');
                toggleSCM('flyAsh');
                alert('‚úÖ Optimized for SUSTAINABILITY:\n‚Ä¢ 70% total SCM\n‚Ä¢ M-Sand\n‚Ä¢ Maximum CO‚ÇÇ reduction');
            } else if (choice === '3') {
                document.getElementById('useSilicaFume').checked = true;
                document.getElementById('useSuperplasticizer').checked = true;
                document.getElementById('silicaFumePercent').value = '10';
                document.getElementById('superplasticizerDosage').value = '2.0';
                document.getElementById('manualWC').checked = true;
                document.getElementById('manualWCValue').value = '0.30';
                toggleSCM('silicaFume');
                toggleSuperplasticizer();
                toggleWCMode();
                alert('‚úÖ Optimized for STRENGTH:\n‚Ä¢ Silica fume 10%\n‚Ä¢ High superplasticizer\n‚Ä¢ Very low W/C ratio');
            }
            calculateMix(false);
        }

        // Batch Calculator
        function calculateBatches(totalVolume, mixerCapacity) {
            const numBatches = Math.ceil(totalVolume / mixerCapacity);
            const lastBatchSize = totalVolume % mixerCapacity || mixerCapacity;
            const mixingTime = mixerCapacity <= 0.5 ? 3 : mixerCapacity <= 1 ? 4 : 5;
            const totalTime = numBatches * (mixingTime + 5); // mixing + loading/discharge
            
            return {
                numBatches,
                lastBatchSize: lastBatchSize.toFixed(2),
                mixingTime,
                totalTime
            };
        }

        // Testing Schedule Generator
        function generateTestingSchedule(volume, concreteType) {
            const cubesPerTest = 3;
            let testAges = [7, 28];
            
            if (concreteType.includes('GGBS') || concreteType.includes('Fly Ash') || concreteType.includes('Geopolymer')) {
                testAges = [7, 28, 56];
            }
            if (concreteType.includes('UHPC') || concreteType.includes('High-Performance')) {
                testAges = [3, 7, 28, 56];
            }
            
            const testsRequired = volume <= 5 ? 1 : volume <= 25 ? 2 : Math.ceil(volume / 25);
            const totalCubes = testsRequired * cubesPerTest * testAges.length;
            
            return {
                testAges,
                testsRequired,
                cubesPerTest,
                totalCubes,
                standards: 'ASTM C39 / IS 516'
            };
        }

        // Durability Assessment
        function assessDurability(wcRatio, totalSCM, hasSilicaFume, hasGGBS, exposure) {
            let chlorideResistance = 'Moderate';
            let carbonationResistance = 'Moderate';
            let sulfateResistance = 'Moderate';
            let freezeThawResistance = 'Moderate';
            
            // Chloride resistance
            if (wcRatio < 0.35 || hasSilicaFume || hasGGBS) {
                chlorideResistance = 'Excellent';
            } else if (wcRatio < 0.45 || totalSCM > 30) {
                chlorideResistance = 'Very Good';
            } else if (wcRatio > 0.55) {
                chlorideResistance = 'Poor';
            }
            
            // Sulfate resistance
            if (hasGGBS || totalSCM > 40) {
                sulfateResistance = 'Excellent';
            } else if (totalSCM > 20) {
                sulfateResistance = 'Very Good';
            }
            
            // Carbonation
            if (totalSCM > 50) {
                carbonationResistance = 'Moderate'; // SCMs can increase carbonation
            } else if (wcRatio < 0.40) {
                carbonationResistance = 'Very Good';
            }
            
            // Freeze-thaw (requires air entraining)
            const hasAirEntraining = document.getElementById('useAirEntraining')?.checked;
            if (hasAirEntraining && wcRatio < 0.45) {
                freezeThawResistance = 'Excellent';
            } else if (hasAirEntraining) {
                freezeThawResistance = 'Very Good';
            } else {
                freezeThawResistance = 'Poor';
            }
            
            // Permeability estimate
            let permeability = wcRatio < 0.35 ? 'Very Low' : wcRatio < 0.45 ? 'Low' : wcRatio < 0.55 ? 'Moderate' : 'High';
            
            return {
                chlorideResistance,
                carbonationResistance,
                sulfateResistance,
                freezeThawResistance,
                permeability,
                overallRating: chlorideResistance === 'Excellent' && sulfateResistance === 'Excellent' ? 'Excellent' : 'Good'
            };
        }

        // Weather Recommendations
        function getWeatherRecommendations(temp, weatherCondition) {
            let recommendations = [];
            
            if (temp > 35 || weatherCondition === 'hot') {
                recommendations.push('‚ö†Ô∏è HOT WEATHER CONCRETING:');
                recommendations.push('‚Ä¢ Use retarder (0.3-0.5%)');
                recommendations.push('‚Ä¢ Consider ice or chilled water');
                recommendations.push('‚Ä¢ Increase mixing time by 25%');
                recommendations.push('‚Ä¢ Cast early morning or evening');
                recommendations.push('‚Ä¢ Protect from sun and wind');
                recommendations.push('‚Ä¢ Extended curing critical');
            } else if (temp < 10 || weatherCondition === 'cold') {
                recommendations.push('‚ùÑÔ∏è COLD WEATHER CONCRETING:');
                recommendations.push('‚Ä¢ Use accelerator (1-2%)');
                recommendations.push('‚Ä¢ Warm water (not >30¬∞C)');
                recommendations.push('‚Ä¢ Protect from freezing for 72 hours');
                recommendations.push('‚Ä¢ Consider heated enclosures');
                recommendations.push('‚Ä¢ Minimum concrete temp: 10¬∞C at placement');
            } else if (weatherCondition === 'windy' || weatherCondition === 'humid') {
                recommendations.push('üí® SPECIAL CONDITIONS:');
                recommendations.push('‚Ä¢ Use windbreaks and covers');
                recommendations.push('‚Ä¢ Apply curing compound immediately');
                recommendations.push('‚Ä¢ Monitor plastic shrinkage cracking');
            }
            
            return recommendations;
        }

        // Visual Charts Generator (Simple ASCII/Text based)
        function generateVisualCharts(strengthPred, costData) {
            const maxStrength = strengthPred.day90;
            const day3Bar = '‚ñà'.repeat(Math.round(strengthPred.day3 / maxStrength * 30));
            const day7Bar = '‚ñà'.repeat(Math.round(strengthPred.day7 / maxStrength * 30));
            const day28Bar = '‚ñà'.repeat(Math.round(strengthPred.day28 / maxStrength * 30));
            const day56Bar = '‚ñà'.repeat(Math.round(strengthPred.day56 / maxStrength * 30));
            const day90Bar = '‚ñà'.repeat(Math.round(strengthPred.day90 / maxStrength * 30));
            
            return `
                <div style="font-family: monospace; background: white; padding: 15px; border-radius: 10px;">
                    <strong style="color: #6a1b9a;">Strength Development Curve:</strong><br><br>
                    <div style="color: #667eea;">3 Days:  ${day3Bar} ${strengthPred.day3} MPa</div>
                    <div style="color: #667eea;">7 Days:  ${day7Bar} ${strengthPred.day7} MPa</div>
                    <div style="color: #4caf50;">28 Days: ${day28Bar} ${strengthPred.day28} MPa ‚≠ê</div>
                    <div style="color: #667eea;">56 Days: ${day56Bar} ${strengthPred.day56} MPa</div>
                    <div style="color: #667eea;">90 Days: ${day90Bar} ${strengthPred.day90} MPa</div>
                </div>
            `;
        }

        // Save Mix to localStorage
        function saveMix() {
            const mixName = prompt("Enter a name for this mix design:", "Mix-" + new Date().toLocaleDateString());
            if (!mixName) return;
            
            const mixData = {
                name: mixName,
                date: new Date().toISOString(),
                grade: document.getElementById('concreteGrade').value,
                results: {
                    cement: document.getElementById('cementResult').textContent,
                    water: document.getElementById('waterResult').textContent,
                    fineAgg: document.getElementById('fineResult').textContent,
                    coarseAgg: document.getElementById('coarseResult').textContent,
                    wcRatio: document.getElementById('wcRatio').textContent,
                    strength: document.getElementById('mixStrength').textContent
                },
                type: document.getElementById('concreteTypeBadge').textContent
            };
            
            let savedMixes = JSON.parse(localStorage.getItem('concreteMixes') || '[]');
            savedMixes.push(mixData);
            localStorage.setItem('concreteMixes', JSON.stringify(savedMixes));
            
            alert(`‚úÖ Mix "${mixName}" saved successfully!\n\nTotal saved mixes: ${savedMixes.length}`);
        }

        // Load Mix from localStorage
        function loadMix() {
            const savedMixes = JSON.parse(localStorage.getItem('concreteMixes') || '[]');
            if (savedMixes.length === 0) {
                alert('No saved mixes found! Save a mix first.');
                return;
            }
            
            let mixList = "Select a mix to load:\n\n";
            savedMixes.forEach((mix, index) => {
                mixList += `${index + 1}. ${mix.name} (${mix.type}) - ${new Date(mix.date).toLocaleDateString()}\n`;
            });
            
            const selection = prompt(mixList + "\nEnter number (or 'delete all' to clear):");
            
            if (selection === 'delete all') {
                if (confirm('Delete all saved mixes?')) {
                    localStorage.removeItem('concreteMixes');
                    alert('All mixes deleted!');
                }
                return;
            }
            
            const index = parseInt(selection) - 1;
            if (index >= 0 && index < savedMixes.length) {
                alert(`Loaded: ${savedMixes[index].name}\n\nNote: This loads results only. Adjust parameters to recreate the mix.`);
            }
        }

        // Compare current mix with saved mix
        let comparisonMix = null;
        function compareMix() {
            if (!comparisonMix) {
                comparisonMix = {
                    name: "Mix 1",
                    cement: document.getElementById('cementResult').textContent,
                    water: document.getElementById('waterResult').textContent,
                    wcRatio: document.getElementById('wcRatio').textContent,
                    strength: document.getElementById('mixStrength').textContent,
                    type: document.getElementById('concreteTypeBadge').textContent
                };
                alert('‚úÖ Mix 1 saved for comparison!\n\nAdjust parameters for Mix 2, then click Compare again.');
                return;
            }
            
            // Show comparison
            const mix2 = {
                name: "Mix 2",
                cement: document.getElementById('cementResult').textContent,
                water: document.getElementById('waterResult').textContent,
                wcRatio: document.getElementById('wcRatio').textContent,
                strength: document.getElementById('mixStrength').textContent,
                type: document.getElementById('concreteTypeBadge').textContent
            };
            
            const comparisonHTML = `
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: #f5f5f5;">
                        <th style="padding: 12px; border: 1px solid #ddd;">Parameter</th>
                        <th style="padding: 12px; border: 1px solid #ddd;">Mix 1</th>
                        <th style="padding: 12px; border: 1px solid #ddd;">Mix 2</th>
                        <th style="padding: 12px; border: 1px solid #ddd;">Difference</th>
                    </tr>
                    <tr><td style="padding: 10px; border: 1px solid #ddd;">Type</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${comparisonMix.type}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${mix2.type}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">-</td></tr>
                    <tr><td style="padding: 10px; border: 1px solid #ddd;">Cement (kg/m¬≥)</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${comparisonMix.cement}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${mix2.cement}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${mix2.cement - comparisonMix.cement}</td></tr>
                    <tr><td style="padding: 10px; border: 1px solid #ddd;">Water (kg/m¬≥)</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${comparisonMix.water}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${mix2.water}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${mix2.water - comparisonMix.water}</td></tr>
                    <tr><td style="padding: 10px; border: 1px solid #ddd;">W/C Ratio</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${comparisonMix.wcRatio}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${mix2.wcRatio}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${(mix2.wcRatio - comparisonMix.wcRatio).toFixed(2)}</td></tr>
                    <tr><td style="padding: 10px; border: 1px solid #ddd;">Strength (MPa)</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${comparisonMix.strength}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${mix2.strength}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${mix2.strength - comparisonMix.strength}</td></tr>
                </table>
                <button onclick="comparisonMix = null; document.getElementById('comparisonCard').style.display = 'none';" 
                        style="margin-top: 15px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">
                    üîÑ New Comparison
                </button>
            `;
            
            document.getElementById('comparisonResults').innerHTML = comparisonHTML;
            document.getElementById('comparisonCard').style.display = 'block';
            document.getElementById('comparisonCard').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Export to PDF - Generate Professional Report
        function exportToPDF() {
            try {
                // First calculate the mix to ensure results are up-to-date
                calculateMix(false);
                
                // Get report container or create it
                let reportContainer = document.getElementById('printReportContainer');
                if (!reportContainer) {
                    reportContainer = document.createElement('div');
                    reportContainer.id = 'printReportContainer';
                    reportContainer.className = 'print-report';
                    document.body.appendChild(reportContainer);
                }
                
                // Generate report content
                const reportHTML = generateReportHTML();
                reportContainer.innerHTML = reportHTML;
                
                // Show the report
                reportContainer.classList.add('active');
            } catch (error) {
                console.error('Error generating report:', error);
                alert('Error generating report: ' + error.message);
            }
        }

        // Generate QR Code
        function generateQR() {
            const mixData = {
                grade: document.getElementById('concreteGrade').value,
                cement: document.getElementById('cementResult').textContent,
                water: document.getElementById('waterResult').textContent,
                wcRatio: document.getElementById('wcRatio').textContent,
                type: document.getElementById('concreteTypeBadge').textContent
            };
            
            const dataString = encodeURIComponent(JSON.stringify(mixData));
            const qrAPI = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${dataString}`;
            
            document.getElementById('qrCodeDisplay').innerHTML = `<img src="${qrAPI}" alt="QR Code" style="max-width: 300px; border: 3px solid #9c27b0; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">`;
            document.getElementById('qrCard').style.display = 'block';
            document.getElementById('qrCard').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Calculate Cost
        function calculateCost(opcWeight, scmWeight, fineWeight, coarseWeight, admixtureWeight, volume) {
            const currency = document.getElementById('currencySymbol').value;
            const cementCost = parseFloat(document.getElementById('cementCost').value);
            const scmCost = parseFloat(document.getElementById('scmCost').value);
            const fineCost = parseFloat(document.getElementById('fineAggCost').value);
            const coarseCost = parseFloat(document.getElementById('coarseAggCost').value);
            const admixCost = parseFloat(document.getElementById('admixtureCost').value);
            
            const opcTotal = (opcWeight * volume * cementCost).toFixed(2);
            const scmTotal = (scmWeight * volume * scmCost).toFixed(2);
            const fineTotal = (fineWeight * volume * fineCost).toFixed(2);
            const coarseTotal = (coarseWeight * volume * coarseCost).toFixed(2);
            const admixTotal = (admixtureWeight * volume * admixCost).toFixed(2);
            const grandTotal = (parseFloat(opcTotal) + parseFloat(scmTotal) + parseFloat(fineTotal) + parseFloat(coarseTotal) + parseFloat(admixTotal)).toFixed(2);
            
            return {
                currency,
                opcTotal,
                scmTotal,
                fineTotal,
                coarseTotal,
                admixTotal,
                grandTotal,
                perCubicMeter: (grandTotal / volume).toFixed(2)
            };
        }

        // Calculate Sustainability Score
        function calculateSustainabilityScore(scmPercent, useMSand, useRecycled, waterReduction) {
            let score = 50; // Base score
            
            // SCM usage (max 30 points)
            score += Math.min(scmPercent * 0.4, 30);
            
            // Water reduction (max 15 points)
            score += Math.min(waterReduction * 0.5, 15);
            
            // M-Sand usage (5 points)
            if (useMSand) score += 5;
            
            score = Math.min(Math.round(score), 100);
            
            let rating = score >= 90 ? 'üåü Excellent' : score >= 75 ? '‚úÖ Very Good' : score >= 60 ? 'üëç Good' : score >= 40 ? '‚ö†Ô∏è Fair' : '‚ùå Poor';
            let color = score >= 90 ? '#2e7d32' : score >= 75 ? '#388e3c' : score >= 60 ? '#fbc02d' : score >= 40 ? '#f57c00' : '#d32f2f';
            
            return { score, rating, color };
        }

        // Get Strength Prediction
        function getStrengthPrediction(targetStrength, hasFlyAsh, hasGGBS, hasSilicaFume) {
            let day3, day7, day28, day56, day90;
            
            if (hasSilicaFume) {
                day3 = targetStrength * 0.75;
                day7 = targetStrength * 0.90;
                day28 = targetStrength;
                day56 = targetStrength * 1.05;
                day90 = targetStrength * 1.10;
            } else if (hasGGBS) {
                day3 = targetStrength * 0.45;
                day7 = targetStrength * 0.65;
                day28 = targetStrength;
                day56 = targetStrength * 1.10;
                day90 = targetStrength * 1.25;
            } else if (hasFlyAsh) {
                day3 = targetStrength * 0.55;
                day7 = targetStrength * 0.70;
                day28 = targetStrength;
                day56 = targetStrength * 1.08;
                day90 = targetStrength * 1.18;
            } else {
                day3 = targetStrength * 0.65;
                day7 = targetStrength * 0.80;
                day28 = targetStrength;
                day56 = targetStrength * 1.03;
                day90 = targetStrength * 1.06;
            }
            
            return {
                day3: Math.round(day3),
                day7: Math.round(day7),
                day28: Math.round(day28),
                day56: Math.round(day56),
                day90: Math.round(day90)
            };
        }

        // Get Curing Schedule
        function getCuringSchedule(concreteType, hasGGBS, hasFlyAsh) {
            let schedule = {};
            
            if (concreteType.includes('Foam')) {
                schedule = {
                    minimum: '3 days',
                    recommended: '7 days',
                    method: 'Moist curing or curing compound',
                    notes: 'Protect from rapid drying. Start curing after 24 hours of setting.'
                };
            } else if (hasGGBS) {
                schedule = {
                    minimum: '14 days',
                    recommended: '21-28 days',
                    method: 'Continuous water curing (ponding or wet burlap)',
                    notes: 'Extended curing critical for GGBS. Prevent early drying to achieve full strength.'
                };
            } else if (hasFlyAsh) {
                schedule = {
                    minimum: '10 days',
                    recommended: '14-21 days',
                    method: 'Water curing or curing compound',
                    notes: 'Fly ash concrete requires longer curing than OPC for strength development.'
                };
            } else if (concreteType.includes('UHPC') || concreteType.includes('High-Performance')) {
                schedule = {
                    minimum: '7 days',
                    recommended: '14 days',
                    method: 'Water curing, start immediately after finishing',
                    notes: 'High-performance concrete is susceptible to plastic shrinkage. Cure immediately.'
                };
            } else {
                schedule = {
                    minimum: '7 days',
                    recommended: '14 days',
                    method: 'Water curing, wet covering, or curing compound',
                    notes: 'Standard curing for normal concrete. Maintain moisture for hydration.'
                };
            }
            
            return schedule;
        }

        // ========== PROFESSIONAL REPORT GENERATION ==========
        function closeReport() {
            const reportContainer = document.getElementById('printReportContainer');
            if (reportContainer) {
                reportContainer.classList.remove('active');
            }
        }
        
        function printReportNow() {
            window.print();
        }
        
        function generateReportHTML() {
            const date = new Date().toLocaleString();
            
            // Helper function to safely get element value
            const safeGetValue = (id, defaultValue = '') => {
                const element = document.getElementById(id);
                if (!element) {
                    console.warn(`Element not found: ${id}`);
                    return defaultValue;
                }
                return element.value || defaultValue;
            };
            
            const safeGetTextContent = (id, defaultValue = '') => {
                const element = document.getElementById(id);
                if (!element) {
                    console.warn(`Element not found: ${id}`);
                    return defaultValue;
                }
                return element.textContent || defaultValue;
            };
            
            const safeGetChecked = (id) => {
                const element = document.getElementById(id);
                if (!element) {
                    console.warn(`Element not found: ${id}`);
                    return false;
                }
                return element.checked || false;
            };
            
            // Get all input values
            const grade = safeGetValue('concreteGrade', '30');
            const targetStrength = grade === 'custom' ? safeGetValue('targetStrength', '30') : grade;
            const exposure = safeGetValue('exposure', 'moderate');
            const placement = safeGetValue('placementType', 'normal');
            const slump = safeGetValue('slump', '100');
            const cementType = safeGetValue('cementType', 'opc53');
            const cementSG = safeGetValue('cementSG', '3.15');
            const fineAggType = safeGetValue('fineAggType', 'natural');
            const fineSG = safeGetValue('fineSG', '2.65');
            const coarseSG = safeGetValue('coarseSG', '2.70');
            const maxAggSize = safeGetValue('maxAggSize', '20');
            const fineAggPercent = (parseFloat(safeGetValue('fineAggPercent', '0.38')) * 100).toFixed(0);
            const coarseAggPercent = (100 - parseFloat(fineAggPercent)).toFixed(0);
            
            // Get SCM details
            const useFlyAsh = safeGetChecked('useFlyAsh');
            const useGGBS = safeGetChecked('useGGBS');
            const useSilicaFume = safeGetChecked('useSilicaFume');
            const useMetakaolin = safeGetChecked('useMetakaolin');
            const useRHA = safeGetChecked('useRHA');
            
            // Get admixture details
            const useSuperplasticizer = safeGetChecked('useSuperplasticizer');
            const useAirEntraining = safeGetChecked('useAirEntraining');
            const useRetarder = safeGetChecked('useRetarder');
            const useAccelerator = safeGetChecked('useAccelerator');
            const useViscosity = safeGetChecked('useViscosity');
            const useFoamAgent = safeGetChecked('useFoamAgent');
            const useFibers = safeGetChecked('useFibers');
            const useWaterproofing = safeGetChecked('useWaterproofing');
            
            // Get results
            const opcResult = safeGetTextContent('cementResult', '0');
            const totalCementResult = safeGetTextContent('totalCementResult', '0');
            const waterResult = safeGetTextContent('waterResult', '0');
            const fineResult = safeGetTextContent('fineResult', '0');
            const coarseResult = safeGetTextContent('coarseResult', '0');
            const wcRatio = safeGetTextContent('wcRatio', '0.45');
            const mixStrength = safeGetTextContent('mixStrength', '30');
            const concreteType = safeGetTextContent('concreteTypeBadge', 'NORMAL CONCRETE');
            
            let scmRows = '';
            if (useFlyAsh) {
                const percent = safeGetValue('flyAshPercent', '25');
                const type = safeGetValue('flyAshClass', 'classF');
                scmRows += `<tr><td>Fly Ash (${type === 'classF' ? 'Class F' : 'Class C'})</td><td>${percent}%</td></tr>`;
            }
            if (useGGBS) {
                const percent = safeGetValue('ggbsPercent', '40');
                scmRows += `<tr><td>GGBS (Slag Cement)</td><td>${percent}%</td></tr>`;
            }
            if (useSilicaFume) {
                const percent = safeGetValue('silicaFumePercent', '7');
                scmRows += `<tr><td>Silica Fume</td><td>${percent}%</td></tr>`;
            }
            if (useMetakaolin) {
                const percent = safeGetValue('metakaolinPercent', '10');
                scmRows += `<tr><td>Metakaolin</td><td>${percent}%</td></tr>`;
            }
            if (useRHA) {
                const percent = safeGetValue('rhaPercent', '15');
                scmRows += `<tr><td>Rice Husk Ash</td><td>${percent}%</td></tr>`;
            }
            
            let admixtureRows = '';
            if (useSuperplasticizer) {
                const dosage = safeGetValue('superplasticizerDosage', '1.0');
                admixtureRows += `<tr><td>Superplasticizer (PCE)</td><td>${dosage}% by cement weight</td></tr>`;
            }
            if (useAirEntraining) {
                const content = safeGetValue('airContent', '5');
                admixtureRows += `<tr><td>Air-Entraining Agent</td><td>${content}% air content</td></tr>`;
            }
            if (useRetarder) {
                const dosage = safeGetValue('retarderDosage', '0.3');
                admixtureRows += `<tr><td>Retarder</td><td>${dosage}% by cement weight</td></tr>`;
            }
            if (useAccelerator) {
                const dosage = safeGetValue('acceleratorDosage', '2.0');
                admixtureRows += `<tr><td>Accelerator</td><td>${dosage}% by cement weight</td></tr>`;
            }
            if (useViscosity) {
                const dosage = safeGetValue('viscosityDosage', '0.5');
                admixtureRows += `<tr><td>Viscosity Modifying Agent</td><td>${dosage}% by cement weight</td></tr>`;
            }
            if (useFoamAgent) {
                const dosage = safeGetValue('foamAgentDosage', '3');
                const density = safeGetValue('foamDensity', '1000');
                admixtureRows += `<tr><td>Foaming Agent</td><td>${dosage}% (Target density: ${density} kg/m¬≥)</td></tr>`;
            }
            if (useFibers) {
                const type = safeGetValue('fiberType', 'steel');
                const dosage = safeGetValue('fiberDosage', '30');
                admixtureRows += `<tr><td>Fibers (${type})</td><td>${dosage} kg/m¬≥</td></tr>`;
            }
            if (useWaterproofing) {
                const dosage = safeGetValue('waterproofingDosage', '2');
                admixtureRows += `<tr><td>Waterproofing Agent</td><td>${dosage}% by cement weight</td></tr>`;
            }
            
            return `
                <button class="close-report-btn" onclick="closeReport()">‚úï Close</button>
                <button class="print-btn" onclick="printReportNow()">üñ®Ô∏è Print/Save as PDF</button>
                
                <div class="print-report-content">
                    <div class="report-header">
                        <div class="logo-circle">
                            <img src="mono.png" alt="Logo" style="height: 100px; display: block;">
                        </div>
                        <h1 style="color: #6366f1; margin: 10px 0;">Concrete Mix Design Report</h1>
                        <p style="font-size: 1.1rem; color: #666;">Quaid-e-Awam University of Engineering, Science & Technology</p>
                        <p style="color: #888; margin-top: 10px;">Generated: ${date}</p>
                    </div>
                    
                    <div class="report-section">
                        <h2>üìã Project Information</h2>
                        <table class="report-table">
                            <tr>
                                <th>Parameter</th>
                                <th>Value</th>
                            </tr>
                            <tr>
                                <td><strong>Concrete Type</strong></td>
                                <td><strong style="color: #6366f1;">${concreteType}</strong></td>
                            </tr>
                            <tr>
                                <td>Target Strength Grade</td>
                                <td>M${targetStrength} (${targetStrength} MPa)</td>
                            </tr>
                            <tr>
                                <td>Exposure Condition</td>
                                <td>${exposure.charAt(0).toUpperCase() + exposure.slice(1)}</td>
                            </tr>
                            <tr>
                                <td>Placement Type</td>
                                <td>${placement === 'normal' ? 'Normal' : placement === 'scc' ? 'Self-Compacting' : placement === 'underwater' ? 'Underwater' : 'Shotcrete'}</td>
                            </tr>
                            <tr>
                                <td>Required Slump</td>
                                <td>${slump} mm</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="report-section">
                        <h2>üî® Materials Specification</h2>
                        <h3>Cement</h3>
                        <table class="report-table">
                            <tr>
                                <th>Material</th>
                                <th>Specification</th>
                            </tr>
                            <tr>
                                <td>Cement Type</td>
                                <td>${cementType === 'opc43' ? 'OPC 43 Grade' : cementType === 'opc53' ? 'OPC 53 Grade' : cementType === 'ppc' ? 'Portland Pozzolana Cement (PPC)' : cementType === 'psc' ? 'Portland Slag Cement (PSC)' : cementType === 'srpc' ? 'Sulfate Resistant Portland Cement (SRPC)' : 'White Portland Cement'}</td>
                            </tr>
                            <tr>
                                <td>Specific Gravity</td>
                                <td>${cementSG}</td>
                            </tr>
                        </table>
                        
                        ${scmRows ? `<h3>Supplementary Cementitious Materials (SCMs)</h3>
                        <table class="report-table">
                            <tr>
                                <th>SCM Type</th>
                                <th>Replacement %</th>
                            </tr>
                            ${scmRows}
                        </table>` : ''}
                        
                        <h3>Aggregates</h3>
                        <table class="report-table">
                            <tr>
                                <th>Aggregate Type</th>
                                <th>Specification</th>
                            </tr>
                            <tr>
                                <td>Fine Aggregate</td>
                                <td>${fineAggType === 'natural' ? 'Natural River Sand' : fineAggType === 'msand' ? 'Manufactured Sand (M-Sand)' : fineAggType === 'mixed' ? 'Mixed (Natural + M-Sand)' : 'Crushed Stone Sand'}</td>
                            </tr>
                            <tr>
                                <td>Fine Aggregate SG</td>
                                <td>${fineSG}</td>
                            </tr>
                            <tr>
                                <td>Coarse Aggregate SG</td>
                                <td>${coarseSG}</td>
                            </tr>
                            <tr>
                                <td>Maximum Aggregate Size</td>
                                <td>${maxAggSize} mm</td>
                            </tr>
                            <tr>
                                <td>Fine Aggregate %</td>
                                <td>${fineAggPercent}%</td>
                            </tr>
                            <tr>
                                <td>Coarse Aggregate %</td>
                                <td>${coarseAggPercent}%</td>
                            </tr>
                        </table>
                        
                        ${admixtureRows ? `<h3>Chemical Admixtures</h3>
                        <table class="report-table">
                            <tr>
                                <th>Admixture Type</th>
                                <th>Dosage</th>
                            </tr>
                            ${admixtureRows}
                        </table>` : ''}
                    </div>
                    
                    <div class="report-section">
                        <h2>üìä Mix Design Results (per m¬≥)</h2>
                        <table class="report-table">
                            <tr>
                                <th>Material</th>
                                <th>Quantity (kg/m¬≥)</th>
                            </tr>
                            <tr style="background: #fef3c7;">
                                <td><strong>OPC (Ordinary Portland Cement)</strong></td>
                                <td><strong>${opcResult} kg</strong></td>
                            </tr>
                            <tr style="background: #fef3c7;">
                                <td><strong>Total Cementitious Materials</strong></td>
                                <td><strong>${totalCementResult} kg</strong></td>
                            </tr>
                            <tr style="background: #dbeafe;">
                                <td><strong>Water</strong></td>
                                <td><strong>${waterResult} kg</strong></td>
                            </tr>
                            <tr>
                                <td>Fine Aggregate (Sand)</td>
                                <td>${fineResult} kg</td>
                            </tr>
                            <tr>
                                <td>Coarse Aggregate</td>
                                <td>${coarseResult} kg</td>
                            </tr>
                        </table>
                        
                        <h3>Key Mix Parameters</h3>
                        <table class="report-table">
                            <tr>
                                <th>Parameter</th>
                                <th>Value</th>
                            </tr>
                            <tr>
                                <td><strong>Water-Cement Ratio (W/C)</strong></td>
                                <td><strong>${wcRatio}</strong></td>
                            </tr>
                            <tr>
                                <td><strong>Mix Strength (with safety factor)</strong></td>
                                <td><strong>${mixStrength} MPa</strong></td>
                            </tr>
                            <tr>
                                <td>Cement : Fine Agg : Coarse Agg (by weight)</td>
                                <td>1 : ${(fineResult / totalCementResult).toFixed(2)} : ${(coarseResult / totalCementResult).toFixed(2)}</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="report-section">
                        <h2>‚ö†Ô∏è Important Notes</h2>
                        <ul style="line-height: 2; color: #555;">
                            <li><strong>Trial Mixes Required:</strong> This is a preliminary design. Conduct trial mixes for verification.</li>
                            <li><strong>Material Quality:</strong> Ensure all materials meet relevant standards (ASTM/IS/BS).</li>
                            <li><strong>Aggregate Moisture:</strong> Adjust water content based on aggregate moisture and absorption.</li>
                            <li><strong>Curing:</strong> Proper curing is essential, especially with SCMs (minimum 7 days for normal, 14+ days with SCMs).</li>
                            <li><strong>Quality Control:</strong> Regular testing of materials and concrete strength is mandatory.</li>
                            <li><strong>Standards Compliance:</strong> Based on ACI 211.1, IS 456, IS 10262, and relevant codes.</li>
                        </ul>
                    </div>
                    
                    <div class="report-section">
                        <h2>üë®‚Äçüî¨ Developed By</h2>
                        <p style="text-align: center; line-height: 1.8; color: #555;">
                            <strong>Dr. Riaz Bhanbhro</strong> | <strong>Dr. Mahboob Oad</strong> | <strong>Dr. Muneeb Memon</strong><br>
                            <strong>Department of Civil Engineering</strong><br>
                            Quaid-e-Awam University of Engineering, Science & Technology (QUEST)<br>
                            Nawabshah, Sindh, Pakistan<br>
                            ¬© 2025 QUEST - All Rights Reserved
                        </p>
                    </div>
                </div>
            `;
        }
        // ========== END PROFESSIONAL REPORT GENERATION ==========

        window.addEventListener('load', function() {
            // Clear all checkboxes on page load (prevent browser auto-fill)
            document.getElementById('useFlyAsh').checked = false;
            document.getElementById('useGGBS').checked = false;
            document.getElementById('useSilicaFume').checked = false;
            document.getElementById('useMetakaolin').checked = false;
            document.getElementById('useRHA').checked = false;
            document.getElementById('useSuperplasticizer').checked = false;
            document.getElementById('useAirEntraining').checked = false;
            document.getElementById('useRetarder').checked = false;
            document.getElementById('useAccelerator').checked = false;
            document.getElementById('useViscosity').checked = false;
            document.getElementById('useFoamAgent').checked = false;
            document.getElementById('useFibers').checked = false;
            document.getElementById('useWaterproofing').checked = false;
            document.getElementById('useRCA').checked = false;
            document.getElementById('useRecycledBrick').checked = false;
            document.getElementById('useLightweightAgg').checked = false;
            
            // Hide all options divs on page load
            ['flyAshOptions', 'ggbsOptions', 'silicaFumeOptions', 'metakaolinOptions', 'rhaOptions',
             'superplasticizerOptions', 'airEntrainingOptions', 'retarderOptions', 'acceleratorOptions',
             'waterproofingOptions', 'viscosityOptions', 'foamAgentOptions', 'fibersOptions', 
             'rcaOptions', 'recycledBrickOptions', 'lightweightAggOptions'].forEach(id => {
                const element = document.getElementById(id);
                if (element) element.style.display = 'none';
            });
            
            // Initialize all slider values on page load
            updateSliderValue('flyAsh');
            updateSliderValue('ggbs');
            updateSliderValue('silicaFume');
            updateSliderValue('metakaolin');
            updateSliderValue('rha');
            updateSliderValue('quarryDust');
            updateSliderValue('stoneDust');
            updateSliderValue('rca');
            updateSliderValue('recycledBrick');
            updateSliderValue('lightweightAgg');
            updateSliderValue('superplasticizer');
            updateSliderValue('retarder');
            updateSliderValue('accelerator');
            updateSliderValue('airContent');
            updateSliderValue('waterproofing');
            updateSliderValue('viscosity');
            updateSliderValue('foamDensity');
            updateSliderValue('foamAgent');
            updateSliderValue('fiber');
            updateSliderValue('ambientTemp');
            updateSliderValue('pigment');
            
            // Welcome message
            console.log('üèóÔ∏è Advanced Concrete Mix Design Dashboard');
            console.log('üë®‚Äçüî¨ Developed by Dr. Riaz Bhanbhro, Dr. Mahboob Oad, Dr. Muneeb Memon');
            console.log('üèõÔ∏è Quaid-e-Awam University of Engineering, Science & Technology');
            console.log('¬© 2025 QUEST Civil Engineering Department');
            
            // Auto-fetch prices on page load
            fetchMarketPrices();
            
            updateFromGrade();
            calculateMix(false);
        });
    </script>
</body>
</html>
